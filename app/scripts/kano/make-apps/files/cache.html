<script>
    (function (Kano) {

        Kano.MakeApps = Kano.MakeApps || {};
        Kano.MakeApps.Files = Kano.MakeApps.Files || {};

        let cache = {};

        Kano.MakeApps.Files.Cache = {
            getFile (type, name) {
                const url = Kano.MakeApps.Files.generators[type](name);
                let cachedPromise = this.get(url);
                if (!cachedPromise) {
                    cachedPromise = this.load(Kano.MakeApps.Files.types[type], url);
                }
                return cachedPromise;
            },
            load (type, url) {
                return fetch(url)
                    .then(r => {
                        switch (type) {
                            case 'audio': {
                                return r.arrayBuffer();
                            }
                            case 'json': {
                                return r.json();
                            }
                            default: {
                                return r.text();
                            }
                        }
                    });
            },
            get (url) {
                return cache[url];
            },
            set (url, file) {
                cache[url] = file;
            },
            clearCache () {
                cache = {};
            }
        };

    })(window.Kano = window.Kano || {});
</script>
    