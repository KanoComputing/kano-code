<link rel="import" href="./base.html">
<script>
    (function (Kano) {
        let Lightboard, PartsAPI;

        Kano.MakeApps = Kano.MakeApps || {};
        PartsAPI = Kano.MakeApps.PartsAPI = Kano.MakeApps.PartsAPI || {};

        Lightboard = {
            listeners: {
                'update-shape': '_updateShape'
            },
            start () {
                PartsAPI.Base.start.apply(this, arguments);
                this.appModules.getModule('lightboard').on('button-down', this._propagateButtonEvent.bind(this));
            },
            stop () {
                PartsAPI.Base.stop.apply(this, arguments);
                if (this.appModules) {
                    this.appModules.getModule('lightboard').removeListener('button-down', this._propagateButtonEvent);
                }
            },
            clear () {
                return this.appModules.getModule('lightboard').clear(this.render.bind(this));
            },
            turnOn (light, color) {
                return this.appModules.getModule('lightboard').turnOn(light, color, this.render.bind(this));
            },
            turnOff (light) {
                return this.appModules.getModule('lightboard').turnOff(light, this.render.bind(this));
            },
            text (text, color, backgroundColor) {
                return this.appModules.getModule('lightboard').text(text.toString(), color, backgroundColor, this.render.bind(this));
            },
            render () {},
            scroll (text, color, backgroundColor, speed) {
                return this.appModules.getModule('lightboard').scroll(text.toString(), color, backgroundColor, speed, this.render.bind(this));
            },
            _propagateButtonEvent (data) {
                this.fire("lightboard-" + data['button-id']);
            },
            _updateShape (e) {
                this.debounce("updateShape-" + e.detail.id, () => {
                    let shape = e.detail;
                    this.appModules.getModule('lightboard').updateOrCreateShape(shape.id, shape, this.render.bind(this));
                });
            }
        };

        PartsAPI.lightboard = Object.assign({}, PartsAPI.Base, Lightboard);
    })(window.Kano = window.Kano || {});
</script>
