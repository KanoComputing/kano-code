<link rel="import" href="./base.html">
<script>
    (function (Kano) {
        let Lightboard, PartsAPI;

        Kano.MakeApps = Kano.MakeApps || {};
        PartsAPI = Kano.MakeApps.PartsAPI = Kano.MakeApps.PartsAPI || {};

        Lightboard = {
            listeners: {
                'update-shape': '_updateShape'
            },
            stop () {
                PartsAPI.Base.stop.apply(this, arguments);
                this.userListeners = [];
                this.userListeners.forEach((listener) => {
                    this.appModules.getModule('lightboard').removeListener(listener.name, listener.cb);
                });
            },
            turnOn (light, color) {
                return this.appModules.getModule('lightboard').turnOn(light, color);
            },
            turnOff (light) {
                return this.appModules.getModule('lightboard').turnOff(light);
            },
            text (text, color, backgroundColor) {
                return this.appModules.getModule('lightboard').text(text, color, backgroundColor);
            },
            scroll (text, color, backgroundColor, speed) {
                return this.appModules.getModule('lightboard').scroll(text, color, backgroundColor, speed);
            },
            onKeyDown (key, callback) {
                let cb = this._keyDownCheck(key, callback);
                this.userListeners.push({
                    name: 'button-down',
                    cb
                });
                this.appModules.getModule('lightboard').on('button-down', cb);
            },
            _keyDownCheck (key, callback) {
                return (data) => {
                    if (data['button-id'] === key) {
                        callback();
                    }
                };
            },
            _updateShape (e) {
                let shape = e.detail;
                return this.appModules.getModule('lightboard').updateOrCreateShape(shape.id, shape);
            }
        };

        PartsAPI['lightboard'] = Object.assign({}, PartsAPI.Base, Lightboard);
    })(window.Kano = window.Kano || {});
</script>