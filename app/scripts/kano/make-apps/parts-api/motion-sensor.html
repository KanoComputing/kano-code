<link rel="import" href="./dongle-base.html">
<script>
    (function (Kano) {
        let MotionSensor, PartsAPI;

        Kano.MakeApps = Kano.MakeApps || {};
        PartsAPI = Kano.MakeApps.PartsAPI = Kano.MakeApps.PartsAPI || {};

        MotionSensor = {
            start () {
                this.module = 'motionSensor';
                this.lastProximityValue = 255;

                this.handlers = {
                    'proximity-data': (e) => {
                        this.lastProximityValue = this.dataToPercentage(e.proximity);
                        this.fire('proximity-update');
                    },
                    'gesture': (e) => {
                        if (e.type) {
                            let fireString = 'gesture-' + e.type;
                            this.fire(fireString);
                        }
                    }
                };

                PartsAPI.DongleBase.start.apply(this, arguments);
            },
            stop () {
                PartsAPI.DongleBase.stop.apply(this, arguments);

                this.lastProximityValue = 0;
            },
            getValue () {
                return this.lastProximityValue;
            },
            dataToPercentage (value) {
                return Math.round((value / 255) * 100);
            }
        };

        // @polymerBehavior
        Kano.MakeApps.PartsAPI['motion-sensor'] = Object.assign({}, PartsAPI.DongleBase, MotionSensor);
    })(window.Kano = window.Kano || {});
</script>
