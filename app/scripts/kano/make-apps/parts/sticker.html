<link rel="import" href="./parts.html">
<link rel="import" href="./ui.html">
<script>
    (function (Kano) {

        /* globals Blockly */

        let sticker;

        const COLOR = '#E73544';

        sticker = {
            partType: 'ui',
            type: 'sticker',
            label: Kano.MakeApps.Msg.PART_STICKER_NAME,
            image: '/assets/part/image.svg',
            colour: COLOR,
            customizable: {
                properties: [{
                    key: 'src',
                    type: 'image',
                    label: Kano.MakeApps.Msg.IMAGE,
                    options: {
                        files: 'stickers'
                    }
                }, {
                    key: 'size',
                    type: 'range',
                    label: Kano.MakeApps.Msg.SIZE,
                    symbol: 'px'
                }],
                style: []
            },
            nonvolatileProperties: [
                'src', 'size'
            ],
            userProperties: {
                size: 100
            },
            events: [{
                label: Kano.MakeApps.Msg.IS_CLICKED,
                id: 'clicked'
            }],
            globalBlocks: ['assets_get_sticker', 'assets_random_sticker', 'assets_random_sticker_from'],
            blocks: [{
                block: (ui) => {
                    return {
                        id: 'set_sticker',
                        message0: `${ui.name}: ${Blockly.Msg.BLOCK_STICKER_SET}`,
                        args0: [{
                            type: "input_value",
                            name: "PICTURE",
                            check: 'String'
                        }],
                        previousStatement: null,
                        nextStatement: null
                    };
                },
                javascript: (ui) => {
                    return function (block) {
                        let pic = Blockly.JavaScript.valueToCode(block, 'PICTURE'),
                            code = `devices.get('${ui.id}').setSticker(${pic});\n`;
                        return code;
                    };
                },
                pseudo: (ui) => {
                    return function (block) {
                        let pic = Blockly.Pseudo.valueToCode(block, 'PICTURE'),
                            code = `${ui.id}.setSticker(${pic});\n`;
                        return code;
                    };
                }
            }]
        };

        Kano.MakeApps.Parts.registerPart(sticker);
    })(window.Kano = window.Kano || {});
</script>
