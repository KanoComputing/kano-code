<link rel="import" href="../parts.html">
<link rel="import" href="../hardware.html">
<script>
    (function (Kano) {

        const COLOR = '#FFB347';

        let wand = {
            partType: 'hardware',
            type: 'wand',
            label: 'Wand',
            image: '/assets/part/motion.svg',
            colour: COLOR,
            component: 'kano-part-wand',
            configPanel: 'kano-motion-sensor-part-editor',
            customizable: {
                properties: [
                    {
                        key: 'mode',
                        type: 'list',
                        label: Kano.MakeApps.Msg.MODE,
                        value: 'proximity',
                        options: [{
                            value: 'proximity',
                            label: Kano.MakeApps.Msg.PROXIMITY
                        }, {
                            value: 'gesture',
                            label: Kano.MakeApps.Msg.GESTURE
                        }]
                    }, {
                        key: 'updateInterval',
                        type: 'range',
                        label: Kano.MakeApps.Msg.UPDATE_INTERVAL,
                        min: 50,
                        max: 1000
                    }
                ],
                style: []
            },
            userProperties: {
                mode: 'proximity',
                updateInterval: 100
            },
            supportedHardware: ['wand'],
            events: [{
                label: Kano.MakeApps.Msg.PART_GYRO_ACCELEROMETER_READ_DATA,
                id: 'proximity-update'
            },{
                label: Kano.MakeApps.Msg.PART_MOTION_SENSOR_UP,
                id: 'gesture-up'
            },
            {
                label: Kano.MakeApps.Msg.PART_MOTION_SENSOR_DOWN,
                id: 'gesture-down'
            },
            {
                label: Kano.MakeApps.Msg.PART_MOTION_SENSOR_LEFT,
                id: 'gesture-left'
            },
            {
                label: Kano.MakeApps.Msg.PART_MOTION_SENSOR_RIGHT,
                id: 'gesture-right'
            }],
            blocks: [{
                block: (part) => {
                    return {
                        id: 'wand_x',
                        message0: `${part.name} x`,
                        inputsInline: false,
                        output: 'Number'
                    };
                },
                javascript: (part) => {
                    return (block) => {
                        let code = `devices.get('${part.id}').getX()`;
                        return [code];
                    };
                }
            }, {
                block: (part) => {
                    return {
                        id: 'wand_y',
                        message0: `${part.name} y`,
                        inputsInline: false,
                        output: 'Number'
                    };
                },
                javascript: (part) => {
                    return (block) => {
                        let code = `devices.get('${part.id}').getY()`;
                        return [code];
                    };
                }
            }, {
                block: (part) => {
                    return {
                        id: 'wand_z',
                        message0: `${part.name} z`,
                        inputsInline: false,
                        output: 'Number'
                    };
                },
                javascript: (part) => {
                    return (block) => {
                        let code = `devices.get('${part.id}').getZ()`;
                        return [code];
                    };
                }
            }, {
                block: (part) => {
                    return {
                        id: 'wand_speed',
                        message0: `${part.name} %1 speed`,
                        args0: [{
                            type: "field_dropdown",
                            name: "AXIS",
                            options: [['x', 'X'], ['y', 'Y'], ['z', 'Z']]
                        }],
                        inputsInline: false,
                        output: 'Number'
                    };
                },
                javascript: (part) => {
                    return (block) => {
                        let axis = block.getFieldValue('AXIS') || 'X';
                        let code = `devices.get('${part.id}').get${axis}Speed()`;
                        return [code];
                    };
                }
            }]
        };

        Kano.MakeApps.Parts.registerPart(wand);
    })(window.Kano = window.Kano || {});
</script>
