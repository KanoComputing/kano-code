<link rel="import" href="./parts.html">
<link rel="import" href="./ui.html">
<script>
    (function (Kano) {

        let terminal = {
            partType: 'ui',
            type: 'terminal',
            label: Kano.MakeApps.Msg.PART_TERMINAL_NAME,
            component: 'kano-part-terminal',
            image: '/assets/part/terminal.svg',
            colour: '#607d8b',
            excludeDefaultBlocks: true,
            visible: false,
            singleton: true,
            customizable: {
                properties: [],
                style: []
            },
            blocks: [{
                block: (ui) => {
                    return {
                        id: 'toggle_on_off',
                        message0: `${ui.name}: ${Blockly.Msg.BLOCK_TERMINAL_TOGGLE}`,
                        args0: [{
                            type: "field_dropdown",
                            options: [
                                [Blockly.Msg.BLOCK_TERMINAL_ON, 'on'],
                                [Blockly.Msg.BLOCK_TERMINAL_OFF, 'off']
                            ],
                            name: "TOGGLE"
                        }],
                        nextStatement: null,
                        previousStatement: null,
                    }
                },
                javascript: (ui) => {
                    return function (block) {
                        let toggle = block.getFieldValue('TOGGLE') || 'on',
                            value = toggle === 'on' ? true : false;
                        return `devices.get('${ui.id}').toggle(${value});`;
                    };
                },
                pseudo: (ui) => {
                    return function (block) {
                        let toggle = block.getFieldValue('TOGGLE') || 'on',
                            value = toggle === 'on' ? true : false;
                        return `devices.get('${ui.id}').toggle(${value});`;
                    };
                }
            },{
                block: (ui) => {
                    return {
                        id: 'print_line',
                        message0: `${ui.name}: ${Blockly.Msg.BLOCK_TERMINAL_PRINT_LINE}`,
                        args0: [{
                            type: "input_value",
                            name: "MESSAGE"
                        }],
                        nextStatement: null,
                        previousStatement: null,
                        shadow: {
                            'MESSAGE': '<shadow type="text"></shadow>'
                        }
                    }
                },
                javascript: (ui) => {
                    return function (block) {
                        let value = Blockly.JavaScript.valueToCode(block, 'MESSAGE');
                        return `devices.get('${ui.id}').printLine(${value});`;
                    };
                },
                pseudo: (ui) => {
                    return function (block) {
                        let value = Blockly.JavaScript.valueToCode(block, 'MESSAGE');
                        return `devices.get('${ui.id}').printLine(${value});`;
                    };
                }
            },{
                block: (ui) => {
                    return {
                        id: 'print',
                        message0: `${ui.name}: ${Blockly.Msg.BLOCK_TERMINAL_PRINT}`,
                        args0: [{
                            type: "input_value",
                            name: "MESSAGE"
                        }],
                        nextStatement: null,
                        previousStatement: null,
                        shadow: {
                            'MESSAGE': '<shadow type="text"></shadow>'
                        }
                    }
                },
                javascript: (ui) => {
                    return function (block) {
                        let value = Blockly.JavaScript.valueToCode(block, 'MESSAGE');
                        return `devices.get('${ui.id}').print(${value});`;
                    };
                },
                pseudo: (ui) => {
                    return function (block) {
                        let value = Blockly.JavaScript.valueToCode(block, 'MESSAGE');
                        return `devices.get('${ui.id}').print(${value});`;
                    };
                }
            },{
                block: (ui) => {
                    return {
                        id: 'clear',
                        message0: `${ui.name}: ${Blockly.Msg.BLOCK_TERMINAL_CLEAR}`,
                        nextStatement: null,
                        previousStatement: null
                    }
                },
                javascript: (ui) => {
                    return function () {
                        return `devices.get('${ui.id}').clear();`;
                    };
                },
                pseudo: (ui) => {
                    return function () {
                        return `devices.get('${ui.id}').clear();`;
                    };
                }
            }]
        };

        Kano.MakeApps.Parts.registerPart(terminal);
    })(window.Kano = window.Kano || {});
</script>
