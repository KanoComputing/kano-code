<link rel="import" href="../behaviors.html">
<link rel="import" href="../../kano-fs/kano-fs.html">
<link rel="import" href="../kano-file-picker-modal/kano-file-picker-modal.html">

<dom-module id="kano-input-image">
    <style>
    :host {
        display: block;
        @apply(--layout-vertical);
        @apply(--layout-center);
    }
    :host button {
        @apply(--kano-button);
    }
    :host .actions button {
        margin: 7px;
    }
    :host .accept,
    :host .change-button {
        background-color: var(--color-green, green);
    }
    :host .remove-button {
        background-color: var(--color-red, red);
    }
    :host .buttons button {
        margin-left: 5px;
    }
    :host kano-fs {
        margin: 20px;
    }
    :host paper-dialog h2 {
        text-align: center;
        font-weight: 500;
    }
    </style>
    <template>
        <h4>[[title]]</h4>
        <div class="actions">
            <button type="button" on-tap="openModal" class="change-button">Change image</button>
            <button type="button" on-tap="removeImage" class="remove-button" hidden$="[[!src]]">Remove image</button>
        </div>
        <kano-file-picker-modal files="[[files]]" id="modal" on-select-file="fileSelected"></kano-file-picker-modal>
    </template>
</dom-module>
<script type="text/javascript">
    /* globals Polymer, KanoBehaviors */
    class KanoInputImage {

        get behaviors () {
            return [Kano.Behaviors.Input];
        }

        beforeRegister () {
            this.is = 'kano-input-image';
            this.properties = {
                title: {
                    type: String
                },
                size: {
                    type: String,
                    value: '50px'
                },
                src: {
                    type: String,
                    value: null
                }
            };
            this.observers = [
                'valueChanged(src, size)'
            ];
        }

        attached () {
            document.body.appendChild(this.$.modal);
            fetch('/assets/filesets/images.json')
                .then(r => r.json())
                .then((response) => {
                    this.files = response;
                });
        }

        detached () {
            document.body.removeChild(this.$.modal);
        }

        openModal () {
            this.$.modal.open();
        }

        fileSelected (e) {
            let file = e.detail;
            this.set('src', file.data.src);
            this.set('title', file.name);
            this.$.modal.close();
        }

        valueChanged () {
            this.set('value', this.src);
        }

        removeImage () {
            this.set('title', null);
            this.set('src', null);
        }
    }
    Polymer(KanoInputImage);
</script>
