<link rel="import" href="../behaviors.html">

<dom-module id="kano-input-pattern">
    <style>
    :host {
        display: block;
        @apply(--layout-vertical);
    }
    :host .inputs {
        @apply(--layout-horizontal);
    }
    :host kano-input {
        margin-right: 20px;
    }
    :host .patterns {
        @apply(--layout-horizontal);
    }
    :host .pattern {
        width: 50px;
        height: 50px;
        margin: 10px 10px 10px 0px;
    }
    :host .pattern:hover {
        cursor: pointer;
    }
    </style>
    <template>
        <label>{{label}}</label>
        <div class="patterns">
            <template is="dom-repeat" items="{{patterns}}" as="pattern">
                <div class="pattern" style$="[[computePatternStyle(pattern)]]" on-tap="selectPattern"></div>
            </template>
        </div>
        <div class="inputs">
            <kano-input-color value="{{color}}" hidden$="{{!pattern.color}}" label="Color"></kano-input-color>
            <kano-input-size value="{{size}}" hidden$="{{!pattern.size}}" label="Size"></kano-input-size>
        </div>
        <array-selector id="selector" items="{{patterns}}" selected="{{pattern}}"></array-selector>
    </template>
</dom-module>
<script type="text/javascript">
    function hexToRGB (hex) {
        let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }
    class KanoInputPattern {

        get behaviors () {
            return [KanoBehaviors.Input];
        }

        beforeRegister () {
            this.is = 'kano-input-pattern';
            this.properties = {
                pattern: {
                    type: Object
                },
                patterns: {
                    type: Array,
                    value: () => {
                        return [];
                    }
                },
                color: {
                    type: String
                },
                size: {
                    type: String
                },
                backgroundColor: {
                    type: String
                }
            };
            this.observers = [
                'computeValue(pattern.*)',
                'computeValue(color)',
                'computeValue(size)',
                'computeValue(backgroundColor)'
            ];
        }

        inputChanged (e) {
            e.stopPropagation();
        }

        computePatternStyle (pattern) {
            let generatedPattern,
                args;
            if (!pattern) {
                return;
            }
            args = {
                color: pattern.color || 'rgba(0, 0, 0, 0.4)',
                size: pattern.size || '50px',
                backgroundColor: pattern.backgroundColor || 'white'
            };
            generatedPattern = pattern.generator(args);
            return `background: ${generatedPattern}, ${args.backgroundColor}`;
        }

        computeValue () {
            if (!this.pattern) {
                return;
            }
            this.set('value', this.pattern.generator({
                color: this.color || this.pattern.color,
                size: this.size || this.pattern.size,
                backgroundColor: this.backgroundColor || this.pattern.backgroundColor
            }));
        }

        selectPattern (e) {
            let pattern = e.model.get('pattern');
            this.$.selector.select(pattern);
        }

        attached () {
            this.set('patterns', [{
                generator (args) {
                    return `linear-gradient(rgba(255, 255, 255, .2) 50%, transparent 50%, transparent) 0px 0px/${args.size} ${args.size}`;
                },
                size: '50px',
                backgroundColor: '#0ae'
            },{
                generator (args) {
                    return `linear-gradient(90deg, rgba(255, 255, 255, .2) 50%, transparent 50%, transparent) 0px 0px/${args.size} ${args.size}`;
                },
                size: '50px',
                backgroundColor: '#f90'
            },{
                generator (args) {
                    let rgb = hexToRGB(args.color),
                        rgbString;
                    if (!rgb) {
                        return '';
                    }
                    rgbString = `rgba(${rgb.r}, ${rgb.g}, ${rgb.g}, 0.5)`;
                    return `linear-gradient(transparent 50%, ${rgbString} 50%, ${rgbString}) 0 0/${args.size} ${args.size},
                              linear-gradient(90deg, transparent 50%, ${rgbString} 50%, ${rgbString}) 0 0/${args.size} ${args.size}`;
                },
                color: '#c80000',
                size: '50px',
                backgroundColor: 'white'
            },{
                generator (args) {
                    return `linear-gradient(45deg, rgba(255, 255, 255, .2) 25%, transparent 25%,
                                          transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%,
                                          transparent 75%, transparent) 0 0/${args.size} ${args.size}`;
                },
                size: '50px',
                backgroundColor: '#ac0'
            },{
                generator (args) {
                    return `linear-gradient(135deg, rgba(255, 255, 255, .2) 25%, transparent 25%,
                                          transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%,
                                          transparent 75%, transparent) 0 0/${args.size} ${args.size}`;
                },
                size: '50px',
                backgroundColor: '#c16'
            },{
                generator (args) {
                    return `linear-gradient(45deg, ${args.color} 25%, transparent 25%, transparent 75%, ${args.color} 75%, ${args.color}) 0 0/${args.size} ${args.size},
                            linear-gradient(45deg, ${args.color} 25%, transparent 25%, transparent 75%, ${args.color} 75%, ${args.color}) calc(${args.size} / 2) calc(${args.size} / 2)/${args.size} ${args.size}`;
                },
                color: 'black',
                size: '50px',
                backgroundColor: 'white'
            },{
                generator (args) {
                    return `linear-gradient(324deg, ${args.backgroundColor} 4%,   transparent 4%)    -70px 43px/100px 100px,
                            linear-gradient( 36deg, ${args.backgroundColor} 4%,   transparent 4%)    30px 43px/100px 100px,
                            linear-gradient( 72deg, ${args.color} 8.5%, transparent 8.5%)  30px 43px/100px 100px,
                            linear-gradient(288deg, ${args.color} 8.5%, transparent 8.5%)  -70px 43px/100px 100px,
                            linear-gradient(216deg, ${args.color} 7.5%, transparent 7.5%)  -70px 23px/100px 100px,
                            linear-gradient(144deg, ${args.color} 7.5%, transparent 7.5%)  30px 23px/100px 100px,
                            linear-gradient(324deg, ${args.backgroundColor} 4%,   transparent 4%)    -20px 93px/100px 100px,
                            linear-gradient( 36deg, ${args.backgroundColor} 4%,   transparent 4%)    80px 93px/100px 100px,
                            linear-gradient( 72deg, ${args.color} 8.5%, transparent 8.5%)  80px 93px/100px 100px,
                            linear-gradient(288deg, ${args.color} 8.5%, transparent 8.5%)  -20px 93px/100px 100px,
                            linear-gradient(216deg, ${args.color} 7.5%, transparent 7.5%)  -20px 73px/100px 100px,
                            linear-gradient(144deg, ${args.color} 7.5%, transparent 7.5%)  80px 73px/100px 100px`;
                },
                color: '#e3d7bf',
                backgroundColor: '#232927'
            },{
                generator () {
                    return `linear-gradient(90deg, rgba(255,255,255,.07) 50%, transparent 50%) 0 0/13px 13px,
                              linear-gradient(90deg, rgba(255,255,255,.13) 50%, transparent 50%) 0 0/29px 29px,
                              linear-gradient(90deg, transparent 50%, rgba(255,255,255,.17) 50%) 0 0/37px 37px,
                              linear-gradient(90deg, transparent 50%, rgba(255,255,255,.19) 50%) 0 0/53px 53px`;
                },
                backgroundColor: '#026873'
            }]);
            this.$.selector.select(this.patterns[0]);
        }
    }
    Polymer(KanoInputPattern);
</script>
