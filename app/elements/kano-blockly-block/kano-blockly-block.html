<dom-module id="kano-blockly-block">
    <style>
    :host {
        display: block;
        pointer-events: none;
    }
    svg path.blocklyPathDark, svg path.blocklyPathLight {
        display: none;
    }
    svg text.blocklyText {
        fill: white;
    }
    svg g.blocklyEditableText {
        fill: white;
        fill-opacity: 0.6;
    }
    </style>
    <template>
        <svg xmlns="http://www.w3.org/2000/svg" id="svg"></svg>
    </template>
    <script type="text/javascript">
        Polymer({
            is: 'kano-blockly-block',
            properties: {
                type: {
                    type: String,
                    observer: '_typeChanged'
                }
            },
            _createWorskspace () {
                this.ws = new Blockly.WorkspaceSvg({});
                this.ws.isFlyout = true;
                this.wsDom = this.ws.createDom();
                this.transform('translate(10px, 0px)', this.wsDom);
                this.$.svg.appendChild(this.wsDom);
            },
            _typeChanged (type) {
                if (!this.ws) {
                    this._createWorskspace();
                }
                let xml = Blockly.Xml.textToDom(`<xml><block type="${type}"></block></xml>`);
                this.ws.clear();
                this.async(() => {
                    try {
                        Blockly.Xml.domToWorkspace(xml, this.ws);
                    } catch (e) {} // Ignore loading errors
                    this._updateSvgSize();
                });
            },
            _updateSvgSize () {
                let rect = this.wsDom.getBoundingClientRect();
                this.$.svg.style.width = rect.width + 10;
                this.$.svg.style.height = rect.height;
            },
            detached () {
                if (this.ws) {
                    this.ws.dispose();
                }
            }
        });
    </script>
</dom-module>
