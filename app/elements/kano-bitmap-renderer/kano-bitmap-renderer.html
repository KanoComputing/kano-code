<dom-module id="kano-bitmap-renderer">
    <style>
    :host, canvas {
        display: block;
    }
    canvas {
        border: 0px;
        @apply(--kano-bitmap-renderer-canvas);
    }
    </style>
    <template>
        <canvas id="canvas" width$="[[_canvasSize(width, pixelSize, spacing)]]" height$="[[_canvasSize(height, pixelSize, spacing)]]"></canvas>
    </template>
    <script type="text/javascript">
        Polymer({
            is: 'kano-bitmap-renderer',
            properties: {
                width: Number,
                height: Number,
                pixelSize: Number,
                spacing: {
                    type: Number,
                    value: 0
                },
                bitmap: {
                    type: Array,
                    value: () => {
                        return [];
                    }
                }
            },
            attached () {
                this.ctx = this.$.canvas.getContext('2d');
                this._renderCanvas();
            },
            _canvasSize (size, pixelSize, spacing) {
                return size * pixelSize + (size * (spacing * 2));
            },
            _renderCanvas () {
                let x, y;
                this.bitmap.forEach((v, i) => {
                    x = (i % this.width);
                    y = Math.floor(i / this.width);
                    x = this.spacing + x * (this.pixelSize + this.spacing * 2);
                    y = this.spacing + y * (this.pixelSize + this.spacing * 2);
                    this.ctx.fillStyle = v;
                    this.ctx.fillRect(x, y, this.pixelSize, this.pixelSize);
                }, this);
                this._animationFrameId = requestAnimationFrame(this._renderCanvas.bind(this));
            }
        });
    </script>
</dom-module>
