<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/kano-circle-progress/kano-circle-progress.html">

<!--

`kano-challenge-progress` is responsible for showing the progress of the user during
a challenge and to link the user to the next challenge.

As an example, if the component needs to be used for displaying a remixed
challenge whose title is "button-press-onator" and the progress is defined
by a `progress` variable, this would be:

    <kano-challenge-progress progress="0.4"
                             title="button-press-onator"
                             next-challenge="weather"
                             remix-mode></kano-challenge-progress>

 The following custom properties and mixins are also available for styling:

 Custom property | Description | Default
 ----------------|-------------|----------
 `--color-orange` | Background color of the top title and round progress block | `orange`
 `--color-dark-orange` | Background color of the options dropdown | `orange`

@group Kano Elements
@hero hero.svg
@demo ./demo.html
-->
<dom-module id="kano-challenge-progress">
    <style>
        :host {
            display: inline-block;
            @apply(--layout-vertical-reverse);
        }

        :host .circular-progress {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: var(--color-orange, orange);
            padding: 8px;
            border-radius: 50%;
            box-sizing: border-box;
            transform: scale(0);
        }

        :host .title {
            background: var(--color-orange, orange);
            display: inline-block;
            height: 40px;
            line-height: 40px;
            font-size: 15px;
            padding: 0 30px;
            margin-left: -15px;
            border-radius: 5px;
            min-width: 150px;
            text-align: center;
            transform-origin: 0% 50%;
            transform: scale(0, 1);
        }

        :host .title p {
            margin: 0;
            color: white;
            padding: 0;
            opacity: 0;
        }

        :host .progress {
            @apply(--layout-horizontal-reverse);
            @apply(--layout-center);
        }

        :host .actions {
            background: var(--color-dark-orange, orange);
            @apply(--layout-vertical);
            margin-top: -28px;
            border-radius: 5px;
            margin-left: 25px;
            width: calc(100% - 25px);
            transform: scale(1, 0);
            transform-origin: 50% 0%;
        }

        :host .actions .empty-space {
            height: 30px;
        }

        :host .actions a {
            display: block;
            color: white;
            height: 40px;
            line-height: 40px;
            text-align: center;
            cursor: pointer;
            text-transform: uppercase;
        }

        :host .actions .separator {
            background: var(--color-darker-orange, orange);
            border-radius: 5px;
            height: 1px;
            width: 80%;
            margin: auto;
        }

        :host .vertical-aligned {
          display: flex;
          justify-content: center;
          align-items: center;
        }
    </style>
    <template>
        <div class="actions" id="actions" hidden$="{{!remixMode}}">
            <div class="empty-space"></div>
            <template is="dom-if" if="{{nextChallenge}}">
                <a on-tap="goToNextStory"> Next Challenge </a>
                <div class="separator"></div>
            </template>
            <a on-tap="shareApp"> Share App </a>
        </div>
        <div class="progress">
            <div id="title-container" class="title">
                <p id="title">{{title}}</p>
            </div>
            <div id="circle" class="circular-progress">
                <kano-circle-progress value="[[progress]]" radius="34"></kano-circle-progress>
            </div>
        </div>
    </template>
</dom-module>

<script type="text/javascript">

    Polymer({
        is: 'kano-challenge-progress',
        properties: {
            /**
             * The progress [0-1] of the user
             */
            progress: {
                type: Number,
                value: 0
            },
            /**
             * The title of the challenge/story you are displaying
             */
            title: {
                type: String,
                value: ''
            },
            /**
             * It enables the sharing behavior
             */
            remixMode: {
                type: Boolean,
                value: false,
                observer: '_remixModeChanged'
            },
            /**
             * Id of the next challenge
             */
            nextChallenge: {
                type: String,
                value: ''
            }
        },
        ready () {
            this.actionsAnimation = new Animation([{
                transform: 'scale(1, 0)'
            }, {
                transform: 'scale(1, 1)'
            }], {
                duration: 300,
                fill: 'forwards',
                easing: 'ease-in'
            });
        },
        shareApp () {
            this.fire('share-app');
        },
        _remixModeChanged (remix) {
            if (remix) {
                this._openActions();
            } else {
                this._closeActions();
            }
        },
        _openActions () {
            this.actionsAnimation.play();
        },
        _closeActions () {
            this.actionsAnimation.reverse();
        },
        goToNextStory () {
            this.fire('next-story');
        },
        animateIn () {
            this.$.circle.animate([{
                transform: 'scale(0)',
                opacity: 0
            },{
                transform: 'scale(1)',
                opacity: 1
            }], {
                duration: 300,
                easing: 'ease-in',
                fill: 'forwards'
            });
            this.$['title-container'].animate([{
                transform: 'scale(0, 1)'
            },{
                transform: 'scale(1, 1)'
            }], {
                duration: 200,
                delay: 300,
                easing: 'ease-in',
                fill: 'forwards'
            });
            this.$.title.animate([{
                opacity: 0
            },{
                opacity: 1
            }], {
                duration: 200,
                delay: 500,
                easing: 'ease-in',
                fill: 'forwards'
            });
        }

    });
</script>
