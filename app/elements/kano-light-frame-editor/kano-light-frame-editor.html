<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/polymer-filters/polymer-filters.html">
<link rel="import" href="../../bower_components/polymer-filters/filters/compare.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/web-components/kano-icons/kano-icons.html">
<link rel="import" href="../../bower_components/web-components/kano-style/kano-style.html">
<link rel="import" href="../inputs/kano-input-range/kano-input-range.html">
<link rel="import" href="../kano-media-query/kano-media-query.html">
<link rel="import" href="../kano-pixel-canvas/kano-pixel-canvas.html">
<link rel="import" href="../kano-palette/kano-palette.html">
<link rel="import" href="../kano-code-shared-styles/kano-code-shared-styles.html">
<link rel="import" href="../behaviors/kano-media-query-behavior.html">
<dom-module id="kano-light-frame-editor">
    <style include="kano-code-shared-styles">
        :host {
            @apply --layout-vertical;
            @apply --layout-center-justified;
        }
        :host button {
            @apply --kano-button;
            @apply --layout-horizontal;
            @apply --layout-center-justified;
            background-color: var(--color-chateau);
            width: 48px;
            height: 48px;
        }
        .main {
            @apply --layout-horizontal;
            @apply --layout-start-justified;
            padding: 32px 48px;
        }
        :host([medium-screen]) .main,
        :host([small-screen]) .main {
            @apply --layout-vertical;
            padding: 32px;
        }
        :host([small-screen]) .main {
            padding: 32px 16px;
        }
        #palette {
            @apply --layout-horizontal;
            @apply --layout-justified;
            width: 130px;
            text-align: left;
        }
        :host([medium-screen]) #palette {
            width: 72%;
            margin-bottom: 32px;
        }
        :host([small-screen]) #palette {
            width: 80%;
            margin-bottom: 32px;
        }
        .control-container {
            @apply --layout-vertical;
            flex: 1 0 auto;
            min-height: 200px;
        }
        :host([medium-screen]) .control-container label {
            margin-top: 16px;
        }
        :host label {
            display: inline-block;
            font-family: var(--font-body);
            font-size: 16px;
            font-weight: bold;
            text-align: left;
            color: rgba(255,255,255,0.5);
            margin-bottom: 24px;
            @apply --layout-self-start;
        }
        .control-content {
            @apply --layout-flex;
            @apply --layout-vertical;
        }
        .control-content kano-input:first-of-type {
            min-height: 33px;
            margin-bottom: 16px;
            --kano-input-label: {
                width: 40px;
                margin-right: 24px;
            };
        }
        :host .row {
            margin-bottom: 16px;
        }
        :host .row:last-child {
            margin-bottom: 0;
        }
        .control-content kano-input-range {
            --kano-input-range-label: {
                width: 40px;
                margin-right: 24px;
            };
        }
        .canvas-container {
            @apply --layout-flex-none;
            @apply --layout-vertical;
            width: 400px;
            height: 244px;
            margin: 0 36px;
        }
        :host([small-screen]) .canvas-container,
        :host([medium-screen]) .canvas-container {
            margin: 0 0 32px;
        }
        :host([medium-screen]) .canvas-container {
            width: 100%;
        }
        :host([small-screen]) .canvas-container {
            width: 100%;
            min-width: 352px;
        }
        kano-pixel-canvas {
            cursor: none;
            --kano-pixel-editor-background: var(--color-dark);
        }
    </style>
    <template>
        <kano-media-query small-screen="{{smallScreen}}" medium-screen="{{mediumScreen}}" large-screen="{{largeScreen}}">
        </kano-media-query>
        <div class="header"></div>
        <div class="main">
            <kano-palette id="palette" bitmaps="[[bitmap]]" pen-type="{{penType}}" palette="{{palette}}" pen-color="{{penColor}}"></kano-palette>
            <div class="canvas-container">
                <label>Canvas</label>
                <kano-pixel-canvas id="canvas"
                                   bitmap="{{bitmap}}"
                                   spacing="2"
                                   width="[[width]]"
                                   height="[[height]]"
                                   pixel-size="[[pixelSize]]"
                                   palette="[[palette]]"
                                   pen-color="[[penColor]]"
                                   pen-type="[[penType]]"></kano-pixel-canvas>
            </div>
            <div class="control-container">
                <label>Controls</label>
                <div class="control-content">
                    <kano-input type="text" label="Name" value="{{element.name}}"></kano-input>
                    <kano-input-range class="slider row" value="{{selected.userProperties.width}}" label="Width" min="1" max="16"></kano-input-range>
                    <kano-input-range class="slider row" value="{{selected.userProperties.height}}" label="Height" min="1" max="8"></kano-input-range>
                </div>
            </div>
        </div>
    </template>
    <script type="text/javascript">
        Polymer({
            is: 'kano-light-frame-editor',
            behaviors: [PolymerFilters.FilterBehavior, Kano.Behaviors.MediaQueryBehavior],
            properties: {
                selected: {
                    type: Object,
                    notify: true
                },
                bitmap: {
                    type: Array,
                    notify: true
                },
                width: {
                    type: Number,
                    value: 1
                },
                height: {
                    type: Number,
                    value: 1
                }
            },
            observers: [
                '_bitmapChanged(selectedFrame, width, height)',
                '_onSelectedChanged(selected.*)',
                '_onSmallScreenActive(smallScreen)'
            ],
            _onSelectedChanged (e) {
                this.width = this.selected.userProperties.width;
                this.height = this.selected.userProperties.height;
                this.bitmap = this.selected.userProperties.bitmap;
            },
            _generateEmptyBitmap (name, width, height, color='#000000') {
                let length = width * height;
                for (let i = 0; i < length; i++) {
                    this.push(name, color);
                }
            },
            _bitmapChanged () {
                if (!this.bitmap) {
                    return;
                }
                if (this.bitmap.length === 0) {
                    this._generateEmptyBitmap('bitmap', this.width, this.height);
                }
            },
            _addFrame () {
                this.$.frames.addFrame();
            },
            enterQuitsInput () {
                if (event.keyCode == 13) {
                    this.blur();
                    return false;
                }
            },
            _onSmallScreenActive (smallScreen) {
                this.pixelSize = smallScreen ? 18 : 20;
            }
        });
    </script>
</dom-module>
