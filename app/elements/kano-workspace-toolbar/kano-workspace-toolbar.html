<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../kano-animated-svg/kano-animated-svg.html">
<link rel="import" href="../behaviors/kano-app-element-registry-behavior.html">
<link rel="import" href="../behaviors/kano-i18n-behavior.html">

<dom-module id="kano-workspace-toolbar">
    <style>
        :host {
            display: block;
            @apply --layout-horizontal;
            @apply --layout-center-justified;
        }
        :host>div {
            @apply --layout-horizontal;
        }
        [hidden] {
            display: none !important;
        }
        .fullscreen,
        .pause {
            border-right: 2px solid #eee;
        }
        .mouse-position,
        .icon img,
        .panel kano-animated-svg {
            margin: 8px 16px;
        }
        .mouse-position {
            color: white;
        }
        kano-animated-svg {
            width: 17px;
            height: 17px;

            --kano-animated-path: {
                fill: white;
                stroke: white;
                stroke-width: 2px;
                stroke-linecap: round;
                stroke-linejoin: round;
                transition: all ease-in-out 200ms;
            }
        }
        .icon:hover {
            transition: opacity .3s ease;
            opacity: 0.8;
            cursor: pointer;
        }
        .icon {
            display: flex;

            align-items: center;
            justify-content: center;
            transition: background-color .3s ease;
        }
        .spacer {
            flex: 1;
        }
        button {
            @apply --kano-button;
            background-color: #515151;
            padding: 8px 16px;
            cursor: pointer;
            margin-left: 9px;
            transition: background-color .3s ease;
            font-size: 12px;
            border-radius: 2px;
        }
        button span.x {
            display: none;
        }
        button.open span.x {
            display: inline-block;
            transform: translate(0px, -2px);
        }
        #play-pause-button {
            background: #7CC74C;
        }
    </style>
    <template>
        <div class="mouse-position" hidden$="[[mousePositionHidden(showMousePosition)]]">
            x: {{mouseX}}, y: {{mouseY}}
        </div>
        <div class="part-controls" hidden$="[[noPartControls]]">
            <button id="add-part-button" class$="{{_applyButtonClass(partsMenuOpen)}}" on-tap="_togglePartsMenu">
                <span>{{_computePartsMenuButtonLabel(partsMenuOpen)}}</span>
                <span class="x">&nbsp;&times;</span>
            </button>
            <button id="edit-layout-button" class$="{{_applyButtonClass(editableLayout)}}" on-tap="_editLayoutClicked">
                <span>[[_computeEditingButtonLabel(editableLayout)]]</span>
                <span class="x">&nbsp;&times;</span>
            </button>
        </div>
        <div class="player-bar" hidden$="[[noPlayerBar]]">
            <button type="button" on-tap="fullscreenClicked">
                <img src="/assets/icons/fullscreen-icon.svg" alt="Fullscreen mode" />
            </button>
            <button type="button" on-tap="resetClicked">
                <img src="/assets/icons/reset-icon.svg" alt="Reset app" />
            </button>
            <button id="play-pause-button" type="button" on-tap="_runButtonClicked">
                <kano-animated-svg width="19" height="21" paths="[[makeButtonIconPaths]]" selected="{{_getRunningStatus(running)}}"></kano-animated-svg>
            </button>
        </div>
    </template>
</dom-module>

<script type="text/javascript">
    /* globals Polymer, Kano */
    Polymer({
        is: 'kano-workspace-toolbar',
        behaviors: [Kano.Behaviors.AppElementRegistryBehavior, Kano.Behaviors.I18nBehavior],
        properties: {
            mouseX: {
                type: Number
            },
            mouseY: {
                type: Number
            },
            showMousePosition: {
                type: Boolean
            },
            running: {
                type: Boolean
            },
            editableLayout: {
                type: Boolean
            },
            partsMenuOpen: {
                type: Boolean
            },
            noPlayerBar: {
                type: Boolean,
                value: false
            },
            noPartControls: {
                type: Boolean,
                value: false
            }
        },
        ready () {
            this.showMousePosition = false;

            this.makeButtonIconPaths = {
                stopped: 'M 4,18 10.5,14 10.5,6 4,2 z M 10.5,14 17,10 17,10 10.5,6 z',
                running: 'M 2,18 6,18 6,2 2,2 z M 11,18 15,18 15,2 11,2 z'
            };

        },
        attached () {
            this._registerElement('fullscreen-button', this.$['fullscreen-button']);
            this._registerElement('add-part-button', this.$['add-part-button']);
        },
        mousePositionHidden (show) {
            return !show;
        },
        fullscreenClicked (e) {
            this.fire('fullscreen-button-clicked');
        },
        _runButtonClicked (e) {
            this.fire('run-button-clicked');
        },
        resetClicked (e) {
            this.fire('reset-button-clicked');
        },
        _getRunningStatus (running) {
            return running ? 'running' : 'stopped';
        },
        _computeEditingButtonLabel (editableLayout) {
            return editableLayout ? this.localize('DONE', 'done') : this.localize('EDIT_LAYOUT', 'Edit Layout');
        },
        _editLayoutClicked () {
            this.fire('edit-layout-button-clicked');
        },
        _togglePartsMenu () {
            this.fire('toggle-parts-menu');
        },
        _computePartsMenuButtonLabel (open) {
            return open ? this.localize('CLOSE', 'close') : this.localize('ADD_PARTS', 'add parts');
        },
        _applyButtonClass (open) {
            return open ? 'open' : '';
        }
    });
</script>
