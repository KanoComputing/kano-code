<link rel="import" href="../../bower_components/paper-styles/shadow.html">
<script src="../../scripts/util/dom.js"></script>
<dom-module id="kano-tooltip">
    <style>
    :host {
        display: inline-block;
        position: fixed;
    }
    :host .tooltip {
        @apply(--shadow-elevation-6dp);
        background-color: var(--kano-tooltip-color, white);
        border-radius: 4px;
        padding: 10px;
    }
    :host .tooltip:before {
        content: '';
        position: absolute;
        border: 10px solid transparent;
    }
    :host .tooltip.top:before,
    :host .tooltip.bottom:before {
        margin-left: -10px;
        left: 0px;
    }
    :host .tooltip.right:before,
    :host .tooltip.left:before {
        margin-top: -10px;
        top: 0px;
    }
    :host .tooltip.top:before {
        border-top-color: var(--kano-tooltip-color, white);
        top: 100%;
    }
    :host .tooltip.bottom:before {
        border-bottom-color: var(--kano-tooltip-color, white);
        bottom: 100%;
    }
    :host .tooltip.right:before {
        border-right-color: var(--kano-tooltip-color, white);
        left: -20px;
    }
    :host .tooltip.left:before {
        border-left-color: var(--kano-tooltip-color, white);
        left: 100%;
    }
    </style>
    <template>
        <div class$="tooltip [[position]]" id="tooltip">
            <content></content>
        </div>
    </template>
</dom-module>

<script type="text/javascript">
    class KanoTooltip {
        beforeRegister () {
            this.is = 'kano-tooltip';
            this.properties = {
                position: {
                    type: String,
                    value: 'top'
                },
                target: {
                    type: Object
                }
            };
            this.observers = [
                'targetChanged(target.*, position)'
            ];
        }
        targetChanged () {
            let target = this.target,
                rect,
                style,
                tooltipStyle,
                widthCenter,
                heightCenter;

            if (!target) {
                return;
            }
            style = this.style;
            tooltipStyle = this.$.tooltip.style;
            rect = this.getBoundingClientRect();

            widthCenter = target.left + (target.width / 2);
            heightCenter = target.top + (target.height / 2);

            if (['top', 'bottom'].indexOf(this.position) !== -1) {
                style.left = `${widthCenter}px`;
                tooltipStyle.marginLeft = '-50%';
                tooltipStyle.marginRight = '50%';
            } else {
                style.top = `${heightCenter}px`;
                tooltipStyle.marginTop = '-25%';
                tooltipStyle.marginBottom = '25%';
            }

            if (this.position === 'top') {
                style.bottom = `${window.innerHeight - target.top + 20}px`;
            } else if (this.position === 'bottom') {
                style.top = `${target.bottom + 20}px`;
            } else if (this.position === 'right') {
                style.left = `${target.right + 20}px`;
            } else if (this.position === 'left') {
                style.right = `${window.innerWidth - target.left + 20}px`;
            }
        }
        hide () {

        }
    }
    Polymer(KanoTooltip);
</script>
