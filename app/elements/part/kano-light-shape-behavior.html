<link rel="import" href="../ui/behaviors.html">
<script type="text/javascript">

(function (Kano) {
    Kano.Behaviors = Kano.Behaviors || {};

    /**
     * Behavior common to all ui parts that displays a shape on the lightboard
     * Update the coordinates methods to match leds instead of screen pixels
     */
    Kano.Behaviors.LightShapeBehaviorImpl = {
        PIXEL_SIZE: 28,
        start () {
            Kano.Behaviors.UIBehavior.start.call(this);
            this._updateLightboard();
        },
        move (x, y) {
            x *= this.PIXEL_SIZE;
            y *= this.PIXEL_SIZE;
            Kano.Behaviors.UIBehavior.move.call(this, x, y);
            this._updateLightboard();
        },
        setX (x) {
            x *= this.PIXEL_SIZE;
            Kano.Behaviors.UIBehavior.setX.call(this, x);
            this._updateLightboard();
        },
        setY (y) {
            y *= this.PIXEL_SIZE;
            Kano.Behaviors.UIBehavior.setY.call(this, y);
            this._updateLightboard();
        },
        getX () {
            return Math.max(0, Math.floor(Kano.Behaviors.UIBehavior.getX.call(this) / this.PIXEL_SIZE));
        },
        getY () {
            return Math.max(0, Math.floor(Kano.Behaviors.UIBehavior.getY.call(this) / this.PIXEL_SIZE));
        },
        applyTransform () {
            if (!this.model) {
                return;
            }
            let x = Math.min(Math.max(6, 6 + this.PIXEL_SIZE * this.getX()), 6 + (16 - parseInt(this.model.userProperties.width)) * this.PIXEL_SIZE),
                y = Math.min(Math.max(5, 5 + this.PIXEL_SIZE * this.getY()), 5 + (8 - parseInt(this.model.userProperties.height)) * this.PIXEL_SIZE);

            this.transform(`translate(${x}px, ${y}px)`);
        },
        _updateLightboard () {}
    };

    Kano.Behaviors.LightShapeBehavior = [Kano.Behaviors.UIBehavior, Kano.Behaviors.LightShapeBehaviorImpl];
})(window.Kano = window.Kano || {});

</script>
