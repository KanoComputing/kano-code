<link rel="import" href="../kano-ui-behavior.html">
<link rel="import" href="../../../scripts/kano/make-apps/parts-api/microphone.html">
<link rel="import" href="../../../scripts/kano/microphone.html">

<script type="text/javascript">
    /* globals Polymer, Kano */

    Polymer({
        is: 'kano-part-microphone',
        behaviors: [Kano.MakeApps.PartsAPI.microphone, Kano.Behaviors.UIBehavior],
        properties: {
            model: {
                type: Object,
                notify: true
            }
        },

        ready () {
            this.reset();
        },
        attached () {
            Kano.Microphone.start().catch(error => {
                let message;
                if (error.name === 'PermissionDeniedError') {
                    message = 'Kano Code needs permission to use your microphone. You can allow access from your browser settings.';
                } else if (error.name === 'DevicesNotFoundError') {
                    message = 'No microphone was found. The microphone part has been disabled.';
                } else {
                    message = 'Your browser doesn\'t support audio input. The microphone part has been disabled.';
                }
                this.fire('kano-error', {
                    text: message,
                    duration: 0,
                    closeWithButton: true,
                    buttonText: 'OK'
                });
            });
        },
        start () {
            Kano.MakeApps.PartsAPI['microphone'].start.apply(this, arguments);
            this.reset();
        },
        stop () {
            Kano.MakeApps.PartsAPI['microphone'].stop.apply(this, arguments);
            this.reset();
        },
        get volume() {
            return Kano.Microphone.getVolume();
        },
        get pitch() {
            return Kano.Microphone.getPitch();
        },
        getvolume () {
            return this.volume;
        },
        getpitch () {
            return this.pitch;
        }
    });
</script>
