<link rel="import" href="../../behaviors/kano-emitter-behavior.html">
<link rel="import" href="../../ui/behaviors.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="kano-part-gesture-sensor">
    <style>
        :host {
            display: block;
        }
        :host .circle {
            width: 50px;
            height: 50px;
            border-radius: 100%;
            background: red;
            overflow: hidden;
            display: flex;
            flex-direction: column;

            border-style: solid;
            border-width: 0px;
            box-shadow: none;
            /*transition: box-shadow 0.2s;
            transition-timing-function: ease-in-out;*/

            animation-duration: 0.8s;
            animation-timing-function: ease-in-out;
        }
        :host .curtain {
            width: 0;
            height: 0;
            background: rgba(0, 0, 0, .2);

            animation-duration: 0.8s;
            animation-timing-function: ease-in-out;

            display: flex;
        }

        @keyframes pulse {
            0% {
                box-shadow: none;
            }
            25% {
                box-shadow: 0 0 0 10px rgba(255, 0, 0, 0.1);
            }
            50% {
                box-shadow: none;
            }
            75% {
                box-shadow: 0 0 0 10px rgba(255, 0, 0, 0.1);
            }
            100% {
                box-shadow: none;
            }
        }

        @keyframes up {
            0% {
                width: 100%;
                height: 0%;
                margin-top: auto;
            }
            50% {
                width: 100%;
                height: 100%;
            }
            100% {
                width: 100%;
                height: 0%;
                margin-top: none;
            }
        }

        @keyframes down {
            0% {
                width: 100%;
                height: 0%;
                margin-top: none;
            }
            50% {
                width: 100%;
                height: 100%;
            }
            100% {
                width: 100%;
                height: 0%;
                margin-top: auto;
            }
        }

        @keyframes right {
            0% {
                width: 0%;
                height: 100%;
                margin-left: none;
            }
            50% {
                width: 100%;
                height: 100%;
            }
            100% {
                width: 0%;
                height: 100%;
                margin-left: auto;
            }
        }

        @keyframes left {
            0% {
                width: 0%;
                height: 100%;
                margin-left: auto;
            }
            50% {
                width: 100%;
                height: 100%;
            }
            100% {
                width: 0%;
                height: 100%;
                margin-left: none;
            }
        }

        @keyframes far {
            0% {
                width: 0%;
                height: 0%;
                border-radius: 100%;
                margin: auto;
            }
            50% {
                width: 100%;
                height: 100%;
                border-radius: 100%;
                margin: auto;
            }

            100% {
                width: 100%;
                height: 100%;
                border-radius: 100%;
                margin: auto;
            }
        }

        @keyframes near {
            0% {
                width: 100%;
                height: 100%;
                border-radius: 100%;
                margin: auto;
            }
            50% {
                width: 100%;
                height: 100%;
                border-radius: 100%;
                margin: auto;
            }

            100% {
                width: 0%;
                height: 0%;
                border-radius: 100%;
                margin: auto;
            }
        }

        .iris {
            margin: auto;
            background-color: red;
            width: 0;
            height: 0;
            z-index: 10;

            animation-duration: 0.8s;
            animation-timing-function: ease-in-out;
            border-radius: 100%;
        }

        @keyframes farIris {
            0% {
                width: 0%;
                height: 0%;
            }
            50% {
                width: 0%;
                height: 0%;
            }

            100% {
                width: 100%;
                height: 100%;
            }
        }

        @keyframes nearIris {
            0% {
                width: 100%;
                height: 100%;
            }
            50% {
                width: 0%;
                height: 0%;
            }

            100% {
                width: 0%;
                height: 0%;
            }
        }
    </style>

    <template>
        <div class="circle" id="w">
            <div class="curtain" id="c">
                <div class="iris" id="i">
                </div>
            </div>
        </div>
    </template>

    <script type="text/javascript">
        /* globals Polymer, Kano */

        Polymer({
            is: 'kano-part-gesture-sensor',
            behaviors: [Kano.Behaviors.UIBehavior,
                        Kano.Behaviors.EmitterBehavior,
                        Kano.Behaviors.AnimatableBehavior],
            attached () {
                Kano.AppModules.getModule('gestureSensor').connect({
                    name: 'Make Apps'
                });
            },
            _animate (type) {
                this.$.w.style['animation-name'] = 'pulse';
                this.$.c.style['animation-name'] = type;

                setTimeout(() => {
                    this.$.w.style['animation-name'] = '';
                    this.$.c.style['animation-name'] = '';
                }, 801);
            },
            start () {
                Kano.Behaviors.UIBehavior.start.apply(this, arguments);
                this.gestureEventListener = (e) => {
                    if (e.type) {
                        this._animate(e.type);
                        this.fire('gesture-' + e.type);
                    }
                };
                Kano.AppModules.getModule('gestureSensor').on('gesture-sensor:0:gesture', this.gestureEventListener);
            },
            stop () {
                Kano.Behaviors.UIBehavior.stop.apply(this, arguments);
                Kano.Behaviors.EmitterBehavior.stop.apply(this, arguments);
                Kano.AppModules.getModule('gestureSensor').removeListener('gesture-sensor:0:gesture', this.gestureEventListener);
            }
        });
    </script>
</dom-module>
