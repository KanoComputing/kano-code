<link rel="import" href="../kano-drop-down/kano-drop-down.html">
<link rel="import" href="../kano-notifications/kano-notifications.html">
<link rel="import" href="../kano-user-avatar/kano-user-avatar.html">

<dom-module id='kano-header'>
    <style>
    :host {
        -webkit-font-smoothing: antialiased;
        font-smoothing: antialiased;
    }

    :host .page-width {
        max-width: 1000px;
        margin: auto;
        padding: 0 30px;
        box-sizing: border-box;
        -webkit-box-sizing: border-box;
        height: 70px;
    }

    @media screen and (max-width: 600px) {
        :host .page-width {
            padding 0 10px
        }
    }

    :host nav {
        background: #fff;
        display: block;
        width: 100%;
        z-index: 999;
        position: fixed;
        top: 0;
        left: 0;
        height: 70px;
        -webkit-box-shadow: 0 0 5px rgba(0,0,0,0.15);
        box-shadow: 0 0 5px rgba(0,0,0,0.15);
    }

    :host nav .logo {
        padding: 14px 5px 13px 5px;
        margin: 0 3px;
        vertical-align: middle;
        display: inline-block;
        width: 110px;
    }

    :host nav .logo > a:before {
        background-image: url('../../assets/kano.svg');
        background-position: center center;
        background-repeat: no-repeat;
        width: 100px;
        height: 40px;
        display: inline-block;
        content: '';
        margin-right: 5px;
    }

    :host nav .nav-menu {
        display: inline-block;
        vertical-align: middle;
        width: 820px;
        height: 70px;
    }

    :host nav .nav-menu ul.nav-menu-items {
        float: left;
        list-style: none;
        margin-top: 0;
        margin-left: 0;
        margin-bottom: 0;
        padding-left: 0;
        text-align: center;
        height: 100%;
    }
    :host nav .nav-menu ul.nav-menu-items li {
        float: left;
        padding: 0px;
        height: 67px;
        width: 130px;
        display: inline-block;
        -webkit-tap-highlight-color: transparent;
        position: relative;
        height: 100%;
    }

    :host nav .nav-menu ul.nav-menu-items li:hover {
        border-bottom: 4px solid #66bed3;
    }

    :host nav .nav-menu ul.nav-menu-items li a {
        padding: 23px 5px 13px 5px;
        display: inline-block;
        margin: 0px 3px;
        font-size: 19px;
        font-weight: 700;
        text-decoration: none;
        color: #414042;
    }

    :host nav .nav-menu ul.nav-menu-items li:hover {
        cursor: pointer;
    }

    :host nav .nav-menu ul.nav-menu-items li kano-drop-down {
        display: none;
    }

    :host nav .nav-menu ul.nav-menu-items li.nav-menu-items__open {
        border-bottom: 4px solid #66bed3;
    }

    :host nav .nav-menu ul.nav-menu-items.nav-menu-user-items li.nav-menu-items__open {
        border: none;
    }

    :host nav .nav-menu ul.nav-menu-items li.nav-menu-items__open .icon-chevron-down2:before {
        content: '\e63e'
    }


    :host nav .nav-menu ul.nav-menu-items li.nav-menu-items__open kano-drop-down,
    :host ::content nav .nav-menu ul.nav-menu-items li.nav-menu-items__open kano-notifications kano-drop-down,
    :host ::content nav .nav-menu ul.nav-menu-items li kano-notifications.nav-menu-items__open kano-drop-down,
    :host ::content nav .nav-menu ul.nav-menu-items li.nav-menu-items__open kano-user-avatar kano-drop-down {
        display: block;
    }

    :host .nav-menu-items--separator {
        content: '\00a0';
        border-left: 4px solid #eee;
        pointer-events: none;
        padding: 20px 0px 10px 0px !important;
        width: auto !important;
        height: 40px !important;
        margin-top: 16px;
        margin-left: 20px;
    }

    :host  ul.nav-menu-items.nav-menu-user-items {
        float: right !important;
    }

    :host .nav-menu ul.nav-menu-items.nav-menu-user-items li.menu-item {
        padding: 25px 5px 13px 5px ;
    }


    :host i {
        pointer-events: none;
    }

    :host nav .nav-menu ul.nav-menu-items.nav-menu-user-items li:hover {
        border: none;
    }

    :host ::content kano-notifications .kano-notifications .drop-down {
        width: 340px;
        right: 285px;
        top: 16px;
    }

    :host ::content kano-notifications .kano-notifications .notch {
        left: 17px;
    }

    :host ::content kano-notifications,
    :host ::content kano-notifications img {
        pointer-events: none;
    }

    :host ::content kano-notifications kano-drop-down,
    :host ::content kano-user-avatar kano-drop-down {
        display: none;
    }

    :host ::content nav .nav-menu ul.nav-menu-items li.nav-menu-items__open kano-notifications {
        pointer-events: auto;
    }

    :host .nav-menu ul.nav-menu-items.nav-menu-user-items li.menu-item.menu-item-avatar {
        padding-top: 5px;
    }

    :host nav .nav-menu ul.nav-menu-items.nav-menu-user-items li {
        width: 60px;
    }

    :host ::content kano-user-avatar kano-drop-down.kano-user-avatar .drop-down.kano-drop-down {
        margin-top: 6px;
        right: 130px;
        width: 200px;
    }

    :host .make-items ::content kano-drop-down .drop-down > a .notification-info {
        margin-left: 10px;
    }

    :host ::content kano-user-avatar > div {
        pointer-events: none;
    }

    :host ::content kano-notifications .notification-info {
        padding: 0 15px;
    }

    :host ::content kano-notifications kano-drop-down .drop-down.kano-drop-down a.kano-drop-down .drop-down-item.kano-drop-down {
        padding: 0;
    }

    :host ::content kano-notifications kano-drop-down .drop-down {
        margin-top: 13px;
    }
    </style>
    <template>
        <nav>
            <div class="page-width">
                <div class="logo">
                    <a href="/"></a>
                </div>
                <div class="nav-menu">
                    <ul class="nav-menu-items">
                        <li class="menu-item make-items" on-tap="toggleOpen">
                            <a style="pointer-events: none;">Make</a>
                            <i class="icon-chevron-down2"></i>
                            <kano-drop-down items="{{makeItems}}"></kano-drop-down>
                        </li>
                        <li class="menu-item"><a href='//world.kano.me/projects'>Projects</a></li>
                        <li class="menu-item" on-tap="toggleOpen">
                            <a style="pointer-events: none;">Community</a>
                            <i class="icon-chevron-down2"></i>
                            <kano-drop-down items="{{communityItems}}"></kano-drop-down>
                        </li>
                        <li class="menu-item nav-menu-items--separator"></li>
                        <li class="menu-item nav-menu-items--products">
                            <a href='//kano.me'>Product</a>
                        </li>
                    </ul>
                    <ul class="nav-menu-user-items nav-menu-items">
                        <li class="menu-item" on-tap="toggleOpen">
                            <kano-notifications user="{{user}}"></kano-notifications>
                        </li>
                        <li id="avatar-menu" class="menu-item menu-item-avatar" on-tap="toggleOpen">
                            <kano-user-avatar user="{{user}}"></kano-user-avatar>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </template>
    <script>
        class KanoHeader {
            beforeRegister () {
                this.URL = '//world.kano.me';
                this.is = 'kano-header'
                this.properties = {
                    dropdownVisible: {
                        type: Boolean,
                        value: false
                    },
                    user: {
                        type: Object
                    }
                }
            }

            attached () {
                document.querySelector('#view').addEventListener('tap', (ev) => {
                    if (!ev.target.classList.contains('nav-menu-items__open') || !document.getElementById('avatar-menu').classList.contains('nav-menu-items__open') && this.dropdownVisible) {
                        console.log('eeeee');
                        this.closeDropDown()
                    }
                })

            }

            makeAvatar () {
                console.log(this.user);
            }

            closeDropDown (elem) {
                document.querySelector('.nav-menu-items__open').classList.remove('nav-menu-items__open');

                this.dropdownVisible = false;
            }

            toggleOpen (ev) {
                ev.stopPropagation()
                console.log(ev);
                let wasOpened = ev.target.classList.contains('nav-menu-items__open'),
                    isUserAvatar = false;

                if (ev.target.localName === 'kano-user-avatar') {
                    isUserAvatar = true;
                }

                elem = isUserAvatar ? document.getElementById('avatar-menu') : ev.target;

                console.log('isUserAvatar', isUserAvatar);

                if (!ev.target.classList.contains('menu-item') && !isUserAvatar) {
                    return;
                }


                if (this.dropdownVisible === true) {
                    this.closeDropDown(elem);
                }

                if (isUserAvatar) {
                    wasOpened = elem.classList.contains('nav-menu-items__open');
                }


                if (!wasOpened) {
                    if (isUserAvatar) {
                        elem.classList.add('nav-menu-items__open');
                    } else {
                        ev.target.classList.add('nav-menu-items__open')
                    }

                    this.dropdownVisible = true;
                }

            }

            ready () {
                this.communityItems = [
                    {
                        name: 'Users',
                        url: this.URL + '/users'
                    },
                    {
                        name: "Creations",
                        url: this.URL + '/shares'
                    },
                    {
                        name: "Leaderboard",
                        url: this.URL + '/leaderboards'
                    },
                    {
                        name: "Forum",
                        url: this.URL + '/forum'
                    },
                    {
                        name: "Blog",
                        url: '//blog.kano.me'
                    },
                    {
                        name: "Help Center",
                        url: '//help.kano.me'
                    }
                ]

                this.makeItems = [
                    {
                        name: 'Make Apps',
                        url: '//make-apps.kano.me',
                        img: '/assets/navbar/make-apps.png'
                    },
                    {
                        name: 'Make Art',
                        url: '//art.kano.me',
                        img: '../../assets/navbar/make-art.png'
                    },
                    {
                        name: 'Make Adventures',
                        url: '//adventures.kano.me',
                        img: '../../assets/navbar/make-adventures.png'
                    },
                    {
                        name: 'Kano OS Apps',
                        url: '//apps.kano.me',
                        img: '../../assets/navbar/osapps.png'
                    }
                ]
            }
        }
        Polymer(KanoHeader);
    </script>
</dom-module>
