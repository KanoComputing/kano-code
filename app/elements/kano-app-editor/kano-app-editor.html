<script src="../../bower_components/interact/interact.js"></script>
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../kano-sidebar/kano-sidebar.html">
<link rel="import" href="../kano-side-menu/kano-side-menu.html">
<link rel="import" href="../kano-workspace/kano-workspace.html">
<link rel="import" href="../kano-event-select/kano-event-select.html">
<link rel="import" href="../kano-workspace-controls/kano-workspace-controls.html">
<link rel="import" href="../kano-ui-configuration/kano-ui-configuration.html">
<link rel="import" href="../kano-part-editor/kano-part-editor.html">
<link rel="import" href="../kano-content-tooltip/kano-content-tooltip.html">
<link rel="import" href="../kano-background-editor/kano-background-editor.html">
<link rel="import" href="../kano-root-view/kano-root-view.html">
<link rel="import" href="../behaviors.html">

<dom-module id="kano-app-editor">
    <style>
    :host {
        position: relative;
        display: block;
        @apply(--layout-vertical);
    }
    :host section {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
    }
    :host section #right-panel {
        position: relative;
        @apply(--layout-flex);
        @apply(--layout-vertical);
        @apply(--kano-inset-box-shadow)
        min-width: 38%;
        max-width: 62%;
        width: 62%;
    }
    :host section #left-panel {
        position: relative;
        @apply(--layout-vertical);
        @apply(--kano-box-shadow);
        min-width: 38%;
        max-width: 62%;
        background-color: var(--color-dark, black);
    }
    :host #left-panel kano-workspace {
        @apply(--layout-flex);
        padding: 10px;
    }
    :host .ui-edition kano-workspace-controls {
        min-height: 200px;
    }
    :host kano-root-view {
        @apply(--layout-flex);
    }
    :host #resize {
        position: relative;
        width: 8px;
        cursor: ew-resize;
        background-color: #e1e1e1;
    }
    :host #resize .handle {
        position: absolute;
        background-color: #404040;
        width: 16px;
        height: 38px;
        border: 2px solid #616161;
        border-radius: 5px;
        top: calc(50% - 19px);
        left: -8px;
    }
    :host #resize .handle::before,
    :host #resize .handle::after {
        content: '';
        position: absolute;
        top: calc(50% - 5px);
        width: 2px;
        border-radius: 1px;
        height: 10px;
        background-color: white;
    }
    :host #resize .handle::before {
        left: 3px;
    }
    :host #resize .handle::after {
        right: 3px;
    }
    :host .root-view-wrapper {
        position: relative;
        @apply(--layout-vertical);
        @apply(--layout-flex);
    }
    :host .controls {
        margin: 20px 0px 20px;
        @apply(--layout-horizontal);
        @apply(--layout-around-justified);
        width: 100%;

    }
    :host .controls button {
        @apply(--kano-button-big);
        @apply(--kano-box-shadow);
    }
    :host .share-button {
        background: var(--blue-gradient, blue);
    }
    :host .make-button {
        background: var(--color-orange, orange);
    }
    :host .make-button-running {
        background: var(--color-red, orange);
    }
    :host kano-content-tooltip {
        @apply(--shadow-elevation-16dp);
        position: absolute;
        top: 70px;
        min-width: 300px;
        min-height: 100px;
    }
    :host .menu {
        position: absolute;
        top: 10px;
        left: 10px;
        @apply(--layout-vertical);
        @apply(--layout-center);
        @apply(--layout-center-justified);
        @apply(--kano-icon-button);
    }
    :host .menu iron-image {
        width: 25px;
        height: 25px;
    }
    :host .parts-toggle {
        @apply(--layout-horizontal);
    }
    :host .parts-toggle button {
        @apply(--kano-round-button);
        background: var(--color-green);

        border: 4px solid #57b40c;
        box-shadow: none;
        margin: auto 10px;
    }
    :host .parts-toggle label {
        margin: auto 0;
        display: block;
        color: #a4a4a4;
    }
    :host .parts-toggle button span {
        font-size: 40px;
        transform: translate(0px, -9px) rotate(0deg);
        text-shadow: 1px 1px 0 #57b40c;
        transition: 0.3s;

        display: block;
        margin: auto 10px;
    }
    :host .parts-toggle.open button span {
        transform: translate(4px, -8px) rotate(45deg);
    }
    :host .parts-toggle.open button {
        background: var(--color-green);
    }

    </style>
    <template>
        <section id="section" on-mousemove="mouseMoved" on-mouseup="completedResizing" main>
            <div class="ui-edition" id="left-panel">
                <kano-workspace id="workspace"
                                on-ui-ready="workspaceUiReady"
                                parts="{{addedParts}}"
                                selected="{{selected}}"
                                running="{{running}}"></kano-workspace>
                <div class="controls">
                    <button type="button" class="share-button" on-tap="share" id="share-button">Publish</button>
                    <button type="button" class$="{{getMakeButtonClass(running)}}" on-tap="toggleRunning" id="make-button">{{getMakeButtonLabel(running)}}</button>
                    <div class$="parts-toggle {{applyOpenClass(partsPanelState)}}">
                        <label>{{partsMenuLabel(partsPanelState)}}</label>
                        <button type="button" class="parts-button" on-tap="toggleParts" id="add-part-button">
                            <span>+</span>
                        </button>
                    </div>
                </div>
                <button class="menu"
                        type="button"
                        on-tap="toggleMenu"
                        id="toggle-menu-button">
                    <iron-image src="/assets/icons/menu.png" sizing="contain"></iron-image>
                </button>
            </div>
            <div id="resize" on-mousedown="resizeWorkspace">
                <div class="handle"></div>
            </div>
            <div name="code" class="editor" id="right-panel">
                <paper-drawer-panel
                    id="partsPanel"
                    force-narrow
                    disable-edge-swipe
                    disable-swipe
                    selected="{{partsPanelState}}"
                    drawer-width="80%">
                        <kano-sidebar
                            id="sidebar"
                            ui-elements="{{parts}}"
                            name="parts"
                            on-done="toggleParts"
                            parts="[[addedParts]]"
                            selected="{{selectedParts}}"
                            drawer
                            on-ui-ready="onPartReady"></kano-sidebar>
                        <kano-root-view
                            id="root-view"
                            on-previous="previous"
                            parts="{{addedParts}}"
                            code="{{code}}"
                            default-categories="{{defaultCategories}}"
                            main></kano-root-view>
                </paper-drawer-panel>
            </div>
        </section>
        <kano-content-tooltip id="part-editor-tooltip"
            target="[[partEditorTarget]]"
            hidden$="[[!partEditorOpened]]"
            on-close="closePartEditor"
            colour="[[selected.colour]]"
            title="[[selected.name]]">
            <kano-part-editor selected="{{selected}}" class="tooltip-content" id="part-editor"></kano-part-editor>
        </kano-content-tooltip>
        <kano-content-tooltip id="background-editor-tooltip"
            target="[[backgroundEditorTarget]]"
            hidden$="[[!backgroundEditorOpened]]"
            on-close="closeBackgroundEditor"
            colour="orange"
            title="Background">
            <kano-background-editor class="tooltip-content" id="background-editor" background="{{background}}" name="background"></kano-background-editor>
        </kano-content-tooltip>
    </template>
</dom-module>

<script src="./kano-app-editor.js"></script>
