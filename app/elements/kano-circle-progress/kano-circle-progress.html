<link rel="import" href="../../bower_components/polymer/polymer.html">
<dom-module id="kano-circle-progress">
    <style>
    :host {
        display: block;
    }
    :host #circle {
        fill: transparent;
        stroke: white;
        transition: stroke-dashoffset linear 200ms;
        stroke-linecap: round;
        @apply(--kano-circle-progress);
        display: none;
    }
    </style>
    <template>
        <svg xmlns="http://www.w3.org/2000/svg" id="svg">
            <circle id="circle"></circle>
        </svg>
    </template>
</dom-module>
<script>
    /* globals Polymer */
    class KanoCircleProgress {

        beforeRegister () {
            this.is = 'kano-circle-progress';
            this.properties = {
                strokeWidth: {
                    type: Number,
                    value: 4,
                    observer: 'update'
                },
                value: {
                    type: Number,
                    value: 0,
                    observer: 'computeDashoffset'
                },
                offsetWidth: {
                    type: Number,
                    value: 50
                }
            };
        }

        attached () {
            this.width = 50;
            this.update();
            this.computeDashoffset(0);
        }

        update () {
            let svg = this.$.svg,
                circle = this.$.circle,
                width = this.width,
                r = width / 2 - this.strokeWidth / 2,
                c = Math.PI * (r * 2);
            if (!this.width) {
                return;
            }
            svg.setAttribute('width', width);
            svg.setAttribute('height', width);
            svg.setAttribute('viewBox', `0 0 ${width} ${width}`);
            circle.setAttributeNS(null, 'cx', width / 2);
            circle.setAttributeNS(null, 'cy', width / 2);
            circle.setAttributeNS(null, 'r', r);
            circle.setAttributeNS(null, 'stroke-width', `${this.strokeWidth}px`);
            circle.setAttributeNS(null, 'stroke-dasharray', c);
            circle.setAttributeNS(null, 'stroke-dashoffset', c);
            circle.setAttributeNS(null, 'transform', `rotate(270, ${width / 2}, ${width / 2})`);
            circle.style.display = 'block';
        }

        computeDashoffset (value) {
            let circle = this.$.circle,
                r = circle.getAttribute('r'),
                c = Math.PI * (r * 2),
                val = Math.max(0, Math.min(1, this.value));

            circle.setAttributeNS(null, 'stroke-dashoffset', (1 - val) * c);
        }

    }
    Polymer(KanoCircleProgress);
</script>
