<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="kano-external-share">
    <style>
        ul.share-buttons {
            list-style: none;
            padding: 0;
            margin-left: 15px;
            margin-bottom: 0;
        }

        ul.share-buttons li {
            display: inline;
            cursor: pointer;
        }

        ul.share-buttons img {
            width: 40px;
        }

        .input-url {
            width: 100%;
            max-width: 250px;
            margin: 15px;
            font-size: 15px;
            padding: 5px;
            font-family: 'Bariol', Helvetica, Arial, sans-serif;
            background: var(--color-black);
            color: white;
            font-weight: 400;
            border: 2px solid #aaaaaa;
        }

        .input-url:focus {
            border: 2px solid white;
        }

        .share-container {
            display: inline;
        }

        paper-dialog, paper-dialog h2, paper-dialog input {
            font-family: 'Bariol', Helvetica, Arial, sans-serif;
        }

        paper-dialog h2 {
            font-weight: bold;
        }

        paper-dialog {
            padding: 20px;
            border-radius: 5px;
        }

        paper-dialog input {
            border: 1px solid #A7A7A7;
            padding: .3em .3em;
            width: 100%;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
            -webkit-box-sizing:border-box;
            -moz-box-sizing: border-box;
            outline-color: #ff842a;
        }

        paper-dialog button {
            @apply(--kano-button);
            background: var(--color-orange);
        }

        paper-dialog .form-group {
            font-size: 1.4em;
            width: 100%;
            margin-bottom: 15px;
        }

        paper-dialog button {
            width: 100%;
            margin: 10px 0;
            font-weight: bold;
        }

        .mail-sent {
            color: white;
            text-align: center;
        }

        .mail-sent-bg {
            background: var(--color-green);
        }

    </style>
    <template>
        <ul class="share-buttons">
            <template is="dom-repeat" items="{{shareConfig}}">
                <li>
                    <div class="share-container" on-click="openShareModal">
                        <img src='{{item.icon}}'>
                    </div>
                </li>
            </template>
        </ul>
        <input id="shareUrl" type="text" value="{{URL}}" class="input-url" on-click="selectShareUrl" readonly></input>

        <paper-dialog id="share_email" on-iron-overlay-closed="closedDialog" class$="{{applySentClass(email_sent)}}" with-backdrop>
            <template is="dom-if" if="{{!email_sent}}">
                <h2>Send Email</h2>
                <form on-submit="sendEmail">
                    <div class="form-group">
                        <label> From </label>
                        <input type="text" name="name" placeholder="Insert your name" value="{{name::change}}" required/>
                    </div>

                    <div class="form-group">
                        <label> Email </label>
                        <input type="email" name="name" placeholder="Insert email" value="{{email::change}}" required/>
                    </div>

                    <button type="submit"> Send </button>
                </form>
            </template>

            <template is="dom-if" if="{{email_sent}}">
                <div class="mail-sent">
                    <h1>Success!</h1>
                    <h2>Email has been sent</h2>
                </div>
            </template>
        </paper-dialog>
    </template>
</dom-module>

<script>

    Polymer({
        is: 'kano-external-share',
        properties: {
            shareConfig: {
                type: Object,
                notify: true
            },
            email_sent: {
                type: Boolean,
                value: false,
                notify: true
            }
        },
        ready () {
            this.share_title = 'Share from Make-Apps';
            this.URL = document.URL;
            this.shareConfig = [
                {
                    'name': 'facebook',
                    'href' : 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(this.URL) + '&t=' + encodeURIComponent(this.URL),
                    'icon' : '/assets/icons/external-share/Facebook.png'
                },
                {
                    'name': 'twitter',
                    'href' : 'https://twitter.com/intent/tweet?source=' + encodeURIComponent(this.URL) + '&text=' + encodeURIComponent(this.share_title + ' ' + this.URL),
                    'icon' : '/assets/icons/external-share/Twitter.png'
                },
                {
                    'name': 'google_plus',
                    'href' : 'https://plus.google.com/share?url=' + encodeURIComponent(this.URL),
                    'icon' : '/assets/icons/external-share/Google+.png'
                },
                {
                    'name': 'tumblr',
                    'href' : 'http://www.tumblr.com/share?v=3&u=' + encodeURIComponent(this.URL) + '&t=' + encodeURIComponent(this.share_title),
                    'icon' : '/assets/icons/external-share/Tumblr.png'
                },
                {
                    'name': 'reddit',
                    'href' : 'http://www.reddit.com/submit?url=' + encodeURIComponent(this.URL) + '&title=' + encodeURIComponent(this.share_title),
                    'icon' : '/assets/icons/external-share/Reddit.png'
                },
                {
                    'name': 'email',
                    'icon' : '/assets/icons/external-share/Mail.png'
                }
            ];
        },
        /**
         * Open the share modal basing on the share service you pass
         * @param  {Event} event
         */
        openShareModal (event) {
            var item = event.model.get('item'),
                URL = item.href;

            if (item.name === 'email') {
                this.$.share_email.open();
            } else {
                window.open(URL, 'newwindow', 'width=500, height=500');
                return false;
            }
        },
        /**
         * Send the email
         * @param  {Event} e
         */
        sendEmail (e) {
            e.preventDefault();

            this.fire('send-email', {
                sentCallback: () => {
                    this.email_sent = true;
                    setTimeout(() => {
                        this.$.share_email.close();
                    }, 3000);
                },
                mailData: {
                    name : this.name,
                    email : this.email,
                    url : this.URL
                }
            });
        },
        /**
         * Called by paper-dialog when the modal has been closed
         */
        closedDialog () {
            this.email_sent = false;
        },
        selectShareUrl () {
            this.$.shareUrl.select();
        },
        applySentClass () {
            return this.email_sent ? 'mail-sent-bg' : '';
        }
    });

</script>
