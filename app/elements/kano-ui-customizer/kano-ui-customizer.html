<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../inputs/kano-input/kano-input.html">
<link rel="import" href="../inputs/kano-input/kano-input.html">
<link rel="import" href="../kano-code-shared-styles/kano-code-shared-styles.html">
<dom-module id="kano-ui-customizer">
    <template>
        <style include="kano-code-shared-styles">
            :host {
                @apply --layout-vertical;
                --kwc-color-picker-size: 29px;
                --kano-color-input-field: {
                    margin: 14px auto 0;
                };
            }
            kano-input {
                margin-bottom: var(--kano-part-editor-input-margin, 24px);
            }
        </style>
        <template is="dom-repeat" items="{{customizable}}" as="property"> 
            <kano-input id$="[[property.key]]"
                    type="{{property.type}}"
                    label="{{property.label}}"
                    symbol="{{property.symbol}}"
                    on-value-changed="propertyChanged"
                    value="[[computeValue(property.key, userValues)]]"
                    min="[[property.min]]"
                    max="[[property.max]]"
                    options="[[property.options]]"
                    theme="[[theme]]"></kano-input>
        </template>
    </template>
</dom-module>

<script type="text/javascript">
    /* globals Polymer */
    Polymer({
        is: 'kano-ui-customizer',
        properties: {
            userValues: {
                type: Object,
                notify: true
            },
            customizable: {
                type: Array,
                value: () => []
            },
            theme: String
        },
        propertyChanged (e) {
            if (Polymer.dom(e).rootTarget.tagName !== 'KANO-INPUT') {
                return;
            }
            let propertyName = e.model.get('property.key'),
                value = e.detail.value;

            if (typeof value === 'number') {
                if (propertyName == 'width' || propertyName == 'height') {
                      value = `${value.toString()}px`;
                } else if (propertyName == 'font-size') {
                      value = `${value.toString()}em`;
                }
            }
            this.set(`userValues.${propertyName}`, value);
        },
        computeValue (propertyName) {
            let value = this.userValues[propertyName];

            if (this._needParsing(value)) {
                value = parseFloat(value, 10);
            }
            return value;
        },
        _needParsing (value) {
            return /\d*\.?\d+(?:px|em)/.test(value);
        }
    });
</script>
