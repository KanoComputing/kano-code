<!-- Overrides page's meta tags and title based on supplied data -->
<dom-module id="kano-meta-tags">
    <template>
        <style></style>
    </template>
    <script type="module">
import { Polymer } from '../../../../../@polymer/polymer/lib/legacy/polymer-fn.js';
Polymer({
    is: 'kano-meta-tags',
    properties: {
        /* Recognised keys: url, title, description, siteName, image */
        metaData: {
            type: Object
        }
    },
    observers: [
        'update(metaData.*)'
    ],
    update () {
        let openTagDict = {
                "og:url": this.metaData.url || "",
                "og:title": this.metaData.title || "",
                "og:description": this.metaData.description || "",
                "og:site_name": this.metaData.siteName || "",
                "og:image": this.metaData.image || ""
            },
            propertyValues = Object.keys(openTagDict);

        for (let i = 0; i < propertyValues.length; i++) {
            let key = propertyValues[i];

            // Only add or update when a value is there
            if (openTagDict[key]) {
                this.addOrUpdateMetaTag(key, openTagDict[key]);
            }
        }

        this.updatePageTitle(this.metaData.title);

        this.fire('meta-tags-updated');
    },
    addOrUpdateMetaTag (propertyAttr, value) {
        let nodeList = [],
            tag,
            updated = false;

        nodeList = Array.from(document.getElementsByTagName('meta'));

        for (tag of nodeList) {
            if (tag.getAttribute('name') === propertyAttr) {
                tag.setAttribute('content', value);
                updated = true;
                break;
            }
        }

        if (!updated) {
            this.createMetaTag(propertyAttr, value);
        }
    },
    createMetaTag (propertyValue, contentValue) {
        let head = document.head,
            meta = document.createElement('meta');

        meta.setAttribute('name', propertyValue);
        meta.setAttribute('content', contentValue);
        head.appendChild(meta);
    },
    updatePageTitle (title) {
        let titles = document.head.getElementsByTagName('title');

        for (let i = 0; i < titles.length; i++) {
            let t = titles[i];

            t.innerHTML = title;
        }

        if (titles.length <= 0) {
            let t = document.createElement('title');
            t.innerHTML = title;
            document.head.appendChild(t);
        }
    }
});
</script>
</dom-module>
