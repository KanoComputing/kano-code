<script src="../../scripts/util/client.js"></script>
<dom-module id="kano-try-chrome">
    <template>
        <style>
            :host {
                display: block;
            }
            paper-toast {
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }
            .actions {
                @apply(--layout-flex);
                @apply(--layout-horizontal);
                @apply(--layout-end-justified);
            }
            button {
                @apply(--kano-button);
                padding: 12px 22px 12px 22px;
                margin-left: 12px;
            }
            .confirm {
                background-color: var(--color-green);
            }
        </style>
        <paper-toast id="toast" text="[[tryChrome]]" class="fit-bottom">
            <div class="actions">
                <button type="button" class="confirm" name="button" on-tap="_tryChrome">Yes!</button>
                <button type="button" name="button" on-tap="_closeChromeToast">No, I'm OK</button>
            </div>
        </paper-toast>
    </template>
    <script>
        Polymer({
            is: 'kano-try-chrome',
            attached () {
                if (!localStorage.getItem('no-chrome')) {
                    let isChromium = window.chrome,
                        winNav = window.navigator,
                        vendorName = winNav.vendor,
                        isOpera = winNav.userAgent.indexOf("OPR") > -1,
                        isIEedge = winNav.userAgent.indexOf("Edge") > -1,
                        isIOSChrome = winNav.userAgent.match("CriOS"),
                        isElectron = winNav.userAgent.match("Electron");

                    if (isElectron) {
                        // Don't suggest Chrome and don't put on alert window
                    }
                    else if((isChromium !== null && isChromium !== undefined && vendorName === "Google Inc." && isOpera == false && isIEedge == false) || ClientUtil.isPi()) {
                        this._onCloseAlert();
                    } else if(isIOSChrome){
                        this._promptToTryChrome();
                        this._onCloseAlert();
                    } else {
                        this._promptToTryChrome();
                        this._onCloseAlert();
                    }
                }
            },
            _promptToTryChrome () {
                this.$.toast.show({
                    text: 'Uh oh. It seems like you are using a browser that might not support all the features of Kano Code. The fun things might not work. Why not try Kano Code with Google Chrome?',
                    duration: Infinity
                });
            },
            _tryChrome () {
                let win = window.open('https://www.google.com/chrome/browser/desktop/index.html', '_blank');
                win.focus();
                this.$.toast.close();
            },
            _closeChromeToast () {
                this.$.toast.close();
                localStorage.setItem('no-chrome', Date.now());
            },
            _onCloseAlert () {
                window.onbeforeunload = () => {
                    return 'Any unsaved changes to your app will be lost. Continue?';
                };
            }
        });
    </script>
</dom-module>
