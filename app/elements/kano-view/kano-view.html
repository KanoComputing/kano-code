<dom-module id="kano-view">
    <style>
    :host {
        display: block;
        @apply(--layout-vertical);
    }
    </style>
    <template>
    </template>
</dom-module>
<script type="text/javascript">
    class KanoView {
        beforeRegister () {
            this.is = 'kano-view';
            this.properties = {
                viewName: {
                    type: String
                },
                location: {
                    type: String,
                    value: 'views',
                },
                attributes: {
                    type: Object,
                    observer: 'attributesChanged',
                    value: () => {
                        return {};
                    }
                }
            };
            this.observers = [
                'viewChanged(viewName)'
            ];
        }
        attributesChanged () {
            if (!this.viewComponent) {
                return;
            }
            this.applyAttributes();
        }
        /**
         * Apply the attributes to the loaded component
         */
        applyAttributes () {
            Object.keys(this.attributes).forEach((attribute) => {
                try {
                    this.viewComponent.set(attribute, this.attributes[attribute]);
                } catch (e) {
                    console.log(e);
                }
            });
        }
        viewChanged () {
            if ((this.viewName && !this.viewName.length) || !this.location) {
                return;
            }
            this.loadView(this.viewName)
                .then(this.displayView.bind(this))
                .catch((e) => {
                    this.fire('kano-error', new Error(`Could not load view ${this.viewName}`));
                });
        }
        displayView () {
            this.viewComponent = document.createElement(this.viewName);
            this.viewComponent.style.flex = 1;
            while (this.firstChild) {
                this.removeChild(this.firstChild);
            }
            this.appendChild(this.viewComponent);
            this.applyAttributes();
        }
        /**
         * Import the view component
         * @param  {String} partial   Name of the component to import
         * @return {Promise}          Will resolve when the element is loaded
         */
        loadView (partial) {
            return new Promise((resolve, reject) => {
                this.importHref(`./${this.location}/${partial}/${partial}.html`, resolve, reject);
            });
        }
    }
    Polymer(KanoView);
</script>
