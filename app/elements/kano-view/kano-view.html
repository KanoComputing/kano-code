<dom-module id="kano-view">
    <style>
    :host {
        display: block;
        @apply(--layout-vertical);
    }
    </style>
    <template>
    </template>
</dom-module>
<script type="text/javascript">
    class KanoView {
        beforeRegister () {
            this.is = 'kano-view';
            this.properties = {
                viewName: {
                    type: String
                },
                location: {
                    type: String,
                    value: 'views',
                },
                attributes: {
                    type: Object,
                    value: () => {
                        return {};
                    },
                    notify: true
                }
            };
            this.observers = [
                'viewChanged(viewName)',
                'attributesChanged(attributes.*)'
            ];
        }
        /**
         * Apply the attributes to the loaded component
         */
        attributesChanged (e) {
            let path;
            if (!this.viewComponent) {
                return;
            }
            path = e.path.split('.');
            path.shift();
            if (!path.length) {
                return;
            }
            path = path.join('.');
            this.viewComponent.set(e.path, e.value);
        }
        viewChanged () {
            if ((this.viewName && !this.viewName.length) || !this.location) {
                return;
            }
            this.loadView(this.viewName)
                .then(this.displayView.bind(this))
                .catch(() => {
                    this.fire('kano-error', new Error(`Could not load view ${this.viewName}`));
                });
        }
        displayView () {
            let view = this.create(this.viewName, this.attributes);
            view.style.flex = 1;
            while (this.firstChild) {
                this.removeChild(this.firstChild);
            }
            this.appendChild(view);
            this.viewComponent = view;
        }
        /**
         * Import the view component
         * @param  {String} partial   Name of the component to import
         * @return {Promise}          Will resolve when the element is loaded
         */
        loadView (partial) {
            return new Promise((resolve, reject) => {
                this.importHref(`./${this.location}/${partial}/${partial}.html`, resolve, reject);
            });
        }
    }
    Polymer(KanoView);
</script>
