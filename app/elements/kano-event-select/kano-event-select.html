<link rel="import" href="../behaviors.html">
<dom-module id="kano-event-select">
    <style>
    :host {
        display: block;
        @apply(--layout-vertical);
        @apply(--layout-center);
    }
    :host .trigger {
        margin: 15px;
        padding: 20px;
        color: var(--color-white, white);
        background-color: var(--color-red, red);
        font-size: 1.2em;
    }
    :host .trigger:hover {
        cursor: pointer;
    }
    </style>
    <template>
        <template is="dom-repeat" items="{{computeTriggers(parts.*)}}" as="trigger">
            <div class="trigger"
                on-tap="selectTrigger">
                <span>[[trigger.text]]</span>
            </div>
        </template>
    </template>
</dom-module>
<script type="text/javascript">
    class KanoEventSelect {

        get behaviors () {
            return [KanoBehaviors.AppEditorBehavior];
        }

        beforeRegister () {
            this.is = 'kano-event-select';
            this.properties = {
                parts: {
                    type: Array
                }
            };
        }
        computeTriggers () {
            if (!this.parts) {
                return;
            }
            return this.parts.reduce((acc, part) => {
                let events;
                if (!part.events) {
                    return acc;
                }
                events = part.events.map((event) => {
                    return {
                        emitter: part.id,
                        event: event.id,
                        text: `When ${part.name} ${event.label}`
                    };
                });
                return acc.concat(events);
            }, []);
        }
        selectTrigger (e) {
            let trigger = e.model.get('trigger');
            this.fire('selected', trigger);
            this.notifyChange('trigger', {
                trigger
            });
        }
    }
    Polymer(KanoEventSelect);
</script>
