<link rel="import" href="../behaviors.html">
<dom-module id="kano-event-select">
    <style>
    :host {
        position: relative;
        display: block;
        @apply(--layout-horizontal);
        padding: 5px 5px 5px 35px;
        @apply(--kano-shadow);
    }
    :host .trigger {
        @apply(--layout-horizontal);
        @apply(--layout-justified);
        margin: 5px;
        padding: 5px;
        font-size: 1.4em;
    }
    :host .trigger:hover {
        cursor: pointer;
    }
    :host .trigger:not(:last-of-type) {
        border-bottom: 1px solid var(--color-grey-light, grey);
    }
    :host .triggers {
        @apply(--layout-vertical);
        @apply(--layout-center-justified);
        @apply(--layout-flex);
    }
    :host .title {
        padding-top: 10px;
        font-size: 1.4em;
        font-weight: 600;
    }
    </style>
    <template>
        <div class="title">Select a Trigger:</div>
        <div class="triggers">
            <template is="dom-repeat" items="{{computeTriggers(parts.*)}}" as="trigger">
                <div class="trigger"
                    on-tap="selectTrigger">
                    <span>[[trigger.text]]</span>
                    <span>&gt;</span>
                </div>
            </template>
        </div>
    </template>
</dom-module>
<script type="text/javascript">
    class KanoEventSelect {

        get behaviors () {
            return [KanoBehaviors.AppEditorBehavior];
        }

        beforeRegister () {
            this.is = 'kano-event-select';
            this.properties = {
                parts: {
                    type: Array
                },
                opened: {
                    type: Boolean,
                    value: false
                }
            };
        }
        toggleOpened () {
            this.opened = !this.opened;
        }
        computeTriggers () {
            if (!this.parts) {
                return;
            }
            return this.parts.reduce((acc, part) => {
                let events;
                if (!part.events) {
                    return acc;
                }
                events = part.events.map((event) => {
                    return {
                        emitter: part.id,
                        event: event.id,
                        text: `When ${part.name} ${event.label}`
                    };
                });
                return acc.concat(events);
            }, []);
        }
        selectTrigger (e) {
            let trigger = e.model.get('trigger');
            this.fire('selected', trigger);
            this.notifyChange('trigger', {
                trigger
            });
        }
    }
    Polymer(KanoEventSelect);
</script>
