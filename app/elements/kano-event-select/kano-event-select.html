<dom-module id="kano-event-select">
    <style>
    :host {
        display: block;
        background-color: var(--primary-color, orange);
        color: var(--color-white, white);
        padding: 4px;
        border-radius: 6px;
    }
    :host select {
        font-size: 0.8em;
        font-weight: 100;
        color: var(--color-white, white);
        background-color: var(--color-orange, orange);
        border-color: var(--color-white, white);
    }
    </style>
    <template>
        <span>When </span>
        <select id="trigger" value="{{selectedTriggerId::change}}">
            <template is="dom-repeat"
                    items="{{triggers}}"
                    as="trigger">
                <option value$="[[trigger.id]]">[[trigger.name]]</option>
            </template>
        </select>
        <select id="select" value$="{{selectedEvent::change}}">
            <template is="dom-repeat"
                    items="{{selectedTrigger.events}}"
                    as="event">
                <option value$="[[event.id]]" selected="selected">[[event.label]]</option>
            </template>
        </select>
    </template>
</dom-module>
<script type="text/javascript">
    class KanoEventSelect {
        beforeRegister () {
            this.is = 'kano-event-select';
            this.properties = {
                triggers: {
                    type: Array
                },
                selectedTriggerId: {
                    type: String,
                    observer: 'selectedTriggerIdChanged'
                },
                selectedTrigger: {
                    type: Object,
                    notify: true
                },
                selectedEvent: {
                    type: String,
                    notify: true
                }
            };
            this.observers = [
                'selectedTriggerChanged(selectedTrigger.*)'
            ];
        }
        /**
         * Update the selected trgigger when the user changes it
         * with the select
         */
        selectedTriggerIdChanged () {
            let triggerElement;
            if (!this.triggers) {
                return;
            }
            triggerElement = this.triggers
                                    .filter((el) => el.id === this.selectedTriggerId);
            if (triggerElement[0]) {
                this.set('selectedTrigger', triggerElement[0]);
            }
        }
        /**
         * Update the choosen trigger and event when the selectedTrigger
         * is updated
         */
        selectedTriggerChanged () {
            // The selected UI element changed, we update the selected
            // option
            if (this.selectedTrigger) {
                this.set('selectedTriggerId', this.selectedTrigger.id);
                this.set('selectedEvent', this.selectedTrigger.events[0].id);
            }
        }
    }
    Polymer(KanoEventSelect);
</script>
