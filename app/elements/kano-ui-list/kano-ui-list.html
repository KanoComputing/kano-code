<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../behaviors/kano-app-editor-behavior.html">
<dom-module id="kano-ui-list">
    <style>
    :host {
        overflow-y: scroll;
        padding: 0 20px;
        color: #383838;
    }
    :host .category {
        display: block;
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        @apply(--layout-start);
        @apply(--layout-start-justified);
        overflow-y: auto;
    }
    :host kano-ui-item {
        --kano-ui-item-color: var(--color-white, white);
        margin: 10px;
    }
    :host .part {
        position: relative;
        max-width: 80px;
    }
    :host .part paper-checkbox {
        position: absolute;
        top: 0px;
        right: 0px;
        --paper-checkbox-size: 36px;
    }
    </style>
    <template>
        <array-selector id="selector" items="{{items}}" selected="{{selected}}" multi toggle></array-selector>
        <template is="dom-repeat" items="{{_usedCategories(categories, items)}}" as="cat">
            <div class="category">
                <template is="dom-repeat" items="{{items}}" filter="[[cat.partType]]Filter" observe="partType">
                    <div class="part">
                        <kano-ui-item
                            model="{{item}}"
                            id$="part-[[item.type]]"
                            on-selected="toggleSelection"
                            selected="[[isPartSelected(item, selected.*)]]"
                            disabled$="[[isHardwareAdded(item)]]"
                            colour="[[cat.colour]]"></kano-ui-item>
                    </div>
                </template>
            </div>
        </template>
    </template>
</dom-module>

<script type="text/javascript">
    /* globals Polymer, Kano */

    Polymer({
        is: 'kano-ui-list',
        behaviors: [Kano.Behaviors.AppEditorBehavior],
        properties: {
            items: {
                type: Array,
                value: () => []
            },
            selected: {
                type: Array,
                notify: true
            },
            parts: {
                type: Array
            },
            categories: {
                type: Object,
                value: [
                    {
                        partType: 'ui',
                        title: 'Interface',
                        colour: '#7eb081'
                    },
                    {
                        partType: 'data',
                        title: 'Data',
                        colour: '#fb5a4c'
                    },
                    {
                        partType: 'hardware',
                        title: 'Hardware',
                        colour: '#3ba9d8'
                    }
                ]
            }
        },
        toggleSelection (e) {
            let item;

            for (let i = 0; i < this.items.length; i++) {
                if (this.items[i].name === name) {
                    item = this.items[i];
                    break;
                }
            }
            if (this.isHardwareAdded(item)) {
                return;
            }
            this.$.selector.select(item);
            if (this.$.selector.isSelected(item)) {
                this.notifyChange('select-new-part', { part: item });
            }
        },
        isHardwareAdded (item) {
            return this.parts.some(part => {
                return part.partType === 'hardware' && part.type === item.type;
            });
        },
        isPartSelected (part) {
            return this.$.selector.isSelected(part);
        },
        clearSelection () {
            this.$.selector.clearSelection();
        },
        uiFilter (item) {
            return item.partType === 'ui';
        },
        dataFilter (item) {
            return item.partType === 'data';
        },
        hardwareFilter (item) {
            return item.partType === 'hardware';
        },
        _usedCategories (categories, parts) {
            let usedCategories = [];

            for (let p = 0; p < parts.length; p++) {
                if (usedCategories.indexOf(parts[p].partType) < 0) {
                    usedCategories.push(parts[p].partType);
                }
            }

            return categories.filter((cat) => usedCategories.indexOf(cat.partType) >= 0);
        }
    });
</script>
