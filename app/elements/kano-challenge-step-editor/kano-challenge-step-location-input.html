<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<dom-module id="kano-challenge-step-location-input">
    <template>
        <style>
            :host {
                display: block;
            }
            paper-item {
                background: var(--color-black);
                --paper-item-selected-weight: 400;
                --paper-item-selected: {
                    color: var(--color-sky);
                };
            }
            paper-listbox {
                --paper-listbox-background-color: var(--color-black);
            }
        </style>
        <paper-dropdown-menu label="Type">
            <paper-listbox class="dropdown-content" selected="{{type}}" attr-for-selected="name">
                <paper-item name="ui-element">UI Element</paper-item>
                <paper-item name="category">Category</paper-item>
                <paper-item name="part-category">Part category</paper-item>
                <paper-item name="flyout-block">Flyout block</paper-item>
                <paper-item name="workspace-block">Workspace block</paper-item>
            </paper-listbox>
        </paper-dropdown-menu>
        <iron-pages id="pages" selected="[[_type]]" attr-for-selected="name">
            <div name="ui-element">
                <paper-input label="ID" value="{{value}}"></paper-input>
            </div>
            <div name="category">
                <paper-input label="category" value="{{value.category}}"></paper-input>
            </div>
            <div name="part-category">
                <paper-input label="part category" value="{{value.category.part}}"></paper-input>
            </div>
            <div name="flyout-block">
                <paper-checkbox checked="{{flyoutFromPart}}">From part</paper-checkbox>
                <div hidden$="[[!flyoutFromPart]]">
                    <paper-input label="Part Id" value="{{value.flyout_block.part}}"></paper-input>
                    <paper-input label="Block Id" value="{{value.flyout_block.type}}"></paper-input>
                </div>
                <div hidden$="[[flyoutFromPart]]">
                    <paper-input label="Block Id" value="{{value.flyout_block}}"></paper-input>
                </div>
            </div>
            <div name="workspace-block">
                <paper-input label="id" value="{{value.id}}"></paper-input>
                <paper-input label="rawId" value="{{value.rawId}}"></paper-input>
                <paper-input label="inputName" value="{{value.inputName}}"></paper-input>
            </div>
        </iron-pages>
    </template>
    <script>
        Polymer({
            is:'kano-challenge-step-location-input',
            properties: {
                value: {
                    type: Object,
                    notify: true
                },
                type: {
                    type: String,
                    observer: '_typeChanged',
                    value: 'ui-element'
                }
            },
            observers: [
                '_flyoutFromPartChanged(flyoutFromPart)',
                '_editorChanged(editor)'
            ],
            attached () {
                this.models = {
                    'ui-element': '',
                    category: {
                        category: ''
                    },
                    'part-category': {
                        category: {
                            part: ''
                        }
                    },
                    'flyout-block': {
                        flyout_block: ''
                    },
                    'workspace-block': {
                        block: {
                            id: '',
                            rawId: '',
                            inputName: ''
                        }
                    }
                }
            },
            _typeChanged (type) {
                let currentEl = this.$.pages.querySelector('.iron-selected'),
                    animPromise = Promise.resolve();
                if (currentEl) {
                    animPromise = new Promise((resolve, reject) => {
                        currentEl.animate({
                            opacity: [1, 0]
                        }, {
                            duration: 300,
                            easing: 'ease-out'
                        }).onfinish = resolve;
                    });
                }
                animPromise.then(() => {
                    let nextEl;
                    if (type) {
                        if (typeof this.models[type] === 'object') {
                            this.value = Object.assign({}, this.models[type]);
                        } else {
                            this.value = this.models[type];
                        }
                    }
                    this._type = type;
                    nextEl = this.$.pages.querySelector('.iron-selected');
                    if (nextEl) {
                        nextEl.animate({
                            opacity: [0, 1]
                        }, {
                            duration: 300,
                            easing: 'ease-out'
                        })
                    }
                });
            },
            _flyoutFromPartChanged (value) {
                if (value) {
                    this.value.flyout_block = {
                        part: '',
                        type: ''
                    };
                } else {
                    this.value.flyout_block = '';
                }
            }
        });
    </script>
</dom-module>