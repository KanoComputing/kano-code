<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../kano-view/kano-view.html">
<script src="../../bower_components/page/page.js"></script>

<dom-module id="kano-routing">
  <template>
    <style>
      :host {
          display: block;
          @apply(--layout-horizontal);
      }
      :host kano-view {
          @apply(--layout-flex);
          @apply(--layout-vertical);
          width: 100%;
      }
    </style>
    <kano-view view-name="[[currentView]]" flex-enabled="[[flexEnabled]]" user="[[user]]"></kano-view>
  </template>
  <script>
  /* globals Polymer, page */
  class KanoRouting {
      beforeRegister () {
          this.is = 'kano-routing';
          this.properties = {
              ctx: {
                  type: Object,
                  notify: true
              },
              user: {
                  type: Object              
              }
          };
      }
      /**
       * Initialize the views
       */
      ready () {
          this.viewLinks = {
              '/': [{
                  label: 'Playground',
                  url: '/make'
              }]
          };

          page('/', this.partial('kano-view-home'));
          page('/apps', this.partial('kano-view-apps'));
          page('/apps/:view', this.partial('kano-view-apps'));
          page('/make', this.partial('kano-view-workshop'));
          page('/preview', this.partial('kano-view-preview'));
          page('/story/:id', this.partial('kano-view-story'));
          page('/remix/:slug', this.partial('kano-view-workshop'));
          page('*', () => {});
          page({hashbang: true});
          //page({ dispatch: false}); // turn off auto dispatching
          page(); // force trigger the initial root page
      }
      /**
       * Creates a function to be used by page.js
       * @param  {String} name  Name of the view component to load
       * @return {Function}     A function ready to be used in page.js
       */
      partial (name) {
          return (ctx) => {
              ctx.links = this.viewLinks[ctx.path];
              this.ctx = ctx;
              this.flexEnabled = (name === 'kano-view-home') ? false : true;
              this.currentView = name;
          };
      }
  }
  Polymer(KanoRouting);
  </script>
</dom-module>
