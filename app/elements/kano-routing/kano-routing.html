<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../kano-view/kano-view.html">
<script src="../../bower_components/page/page.js"></script>

<dom-module id="kano-routing">
  <template>
    <style>
      :host {
          display: block;
          @apply(--layout-horizontal);
      }
      :host kano-view {
          @apply(--layout-flex);
          @apply(--layout-vertical);
          width: 100%;
      }
    </style>
    <kano-view id="view" view-name="[[currentView]]" flex-enabled="[[flexEnabled]]" attributes="[[attributes]]"></kano-view>
  </template>
  <script>
  /* globals Polymer, page */
  class KanoRouting {
      beforeRegister () {
          this.is = 'kano-routing';
          this.properties = {
              ctx: {
                  type: Object,
                  notify: true
              },
              user: {
                  type: Object
              },
              attributes: {
                  type: Object,
                  value: () => {
                      return {};
                  }
              }
          };

          this.observers  = [
              "computeAttributes(user)"
          ];
      }

      computeAttributes (user) {
          this.set("attributes.user", user);
      }
      /**
       * Initialize the views
       */
      ready () {
          page('/', this.partial('kano-view-home'));
          page('/apps', this.partial('kano-view-apps'));
          page('/apps/:view', this.partial('kano-view-apps'));
          page('/make', this.partial('kano-view-workshop'));
          page('/preview', this.partial('kano-view-preview'));
          page('/story/:id', this.partial('kano-view-story'));
          page('/remix/:slug', this.partial('kano-view-workshop'));
          // Used for debugging apps export
          //page('/preview', this.partial('kano-view-preview'));
          page('*', () => {});
          page(); // force trigger the initial root page
      }
      /**
       * Creates a function to be used by page.js
       * @param  {String} name  Name of the view component to load
       * @return {Function}     A function ready to be used in page.js
       */
      partial (name) {
          return (ctx) => {
              this.ctx = ctx;
              this.flexEnabled = (name === 'kano-view-home' || name === 'kano-view-apps') ? false : true;
              this.currentView = name;
          };
      }

      reload () {
          this.$.view.reloadView();
      }
  }
  Polymer(KanoRouting);
  </script>
</dom-module>
