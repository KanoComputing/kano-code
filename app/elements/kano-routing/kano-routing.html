<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-lazy-pages/iron-lazy-pages.html">
<script src="../../bower_components/page/page.js"></script>

<dom-module id="kano-routing">
  <template>
    <style>
      :host {
          display: block;
      }
      :host iron-lazy-pages {
          width: 100%;
          height: 100%;
      }
      :host iron-lazy-pages>* {
          width: 100%;
          height: 100%;
      }
    </style>
    <iron-lazy-pages selected="[[page]]" attr-for-selected="name" restamp hide-immediately>
        <template is="iron-lazy-page" name="home" path="/views/kano-view-home/kano-view-home.html">
            <kano-view-home context="[[context]]" user="{{user}}"></kano-view-home>
        </template>
        <template is="iron-lazy-page" name="story" path="/views/kano-view-story/kano-view-story.html">
            <kano-view-story context="[[context]]" user="{{user}}"></kano-view-story>
        </template>
        <template is="iron-lazy-page" name="editor" path="/views/kano-view-editor/kano-view-editor.html">
            <kano-view-editor context="[[context]]" user="{{user}}"></kano-view-editor>
        </template>
        <template is="iron-lazy-page" name="apps" path="/views/kano-view-apps/kano-view-apps.html">
            <kano-view-apps context="[[context]]" user="{{user}}"></kano-view-apps>
        </template>
    </iron-lazy-pages>
  </template>
  <script>
  /* globals Polymer, page */
  Polymer({
      is: 'kano-routing',
      properties: {
          context: {
              type: Object
          },
          user: {
              type: Object
          },
          attributes: {
              type: Object,
              value: () => {
                  return {};
              }
          },
          page: {
              type: String,
              reflectToAttribute: true
          }
      },
      /**
       * Initialize the views
       */
      ready () {
          page('/',             this.partial('home'));
          page('/apps',         this.partial('apps'));
          page('/apps/:view',   this.partial('apps'));
          page('/make',         this.partial('editor'));
          page('/preview',      this.partial('preview'));
          page('/story/:id',    this.partial('story'));
          page('/remix/:slug',  this.partial('editor'));
          // Used for debugging apps export
          //page('/preview', this.partial('kano-view-preview'));
          page('*', () => {});
          page(); // force trigger the initial root page
      },
      /**
       * Creates a function to be used by page.js
       * @param  {String} name  Name of the view component to load
       * @return {Function}     A function ready to be used in page.js
       */
      partial (name) {
          return (ctx) => {
              this.page = null;
              this.page = name;
              this.context = ctx;
          };
      }
  });
  </script>
</dom-module>
